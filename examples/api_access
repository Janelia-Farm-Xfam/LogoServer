#!/usr/bin/env perl

use strict;
use warnings;
use LWP::UserAgent;
use JSON;

# set up the user agent for submitting requests.
my $ua = LWP::UserAgent->new;
$ua->timeout(20);
$ua->env_proxy;

# get the hmm file.
my $hmm = do { local $/; <DATA> };

my $host = "http://skylign.org";

my %content = (
  'processing' => 'hmm',
  'file' => [undef, 'test.hmm', Content => $hmm ]
);

my $response = $ua->post($host, 'Content-Type' => 'multipart/form-data', Content => \%content, Accept => 'application/json');

my $content = decode_json($response->content);

#grab the image
my $img_url = $content->{url};
my $img_response = $ua->get($img_url, Accept => 'image/png');

open my $img_file ,'>', "logo.png"
  or die "Couldn't open file logo.png for writing: $!\n";

binmode $img_file;

print $img_file $img_response->content;

close $img_file;

__DATA__
HMMER3/f [3.1b1 | February 2013]
NAME  Query
LENG  9
ALPH  amino
RF    no
MM    no
CONS  yes
CS    no
MAP   yes
DATE  Thu Dec  5 11:06:48 2013
NSEQ  13
EFFN  13.000000
CKSUM 229805640
STATS LOCAL MSV       -6.6363  0.95838
STATS LOCAL VITERBI   -7.1095  0.95838
STATS LOCAL FORWARD   -1.9074  0.95838
HMM          A        C        D        E        F        G        H        I        K        L        M        N        P        Q        R        S        T        V        W        Y   
            m->m     m->i     m->d     i->m     i->i     d->m     d->d
  COMPO   2.32693  4.19431  3.20595  2.90711  3.18819  3.12682  3.54476  2.86516  2.73920  2.18112  3.47451  3.48040  3.24556  2.94175  2.94198  2.29172  3.11779  2.60128  6.08761  4.15857
          2.68618  4.42225  2.77519  2.73123  3.46354  2.40513  3.72494  3.29354  2.67741  2.69355  4.24690  2.90347  2.73739  3.18146  2.89801  2.37887  2.77519  2.98518  4.58477  3.61503
          0.00299  6.20994  6.93228  0.61958  0.77255  0.00000        *
      1   1.85892  6.02170  3.83271  2.27291  2.62550  4.34520  4.53433  4.81685  1.70142  4.31783  2.77713  3.82147  4.73834  2.27145  3.76379  1.86232  3.79499  4.40121  6.46700  5.06986      1 k - - -
          2.68618  4.42225  2.77519  2.73123  3.46354  2.40513  3.72494  3.29354  2.67741  2.69355  4.24690  2.90347  2.73739  3.18146  2.89801  2.37887  2.77519  2.98518  4.58477  3.61503
          0.00299  6.20994  6.93228  0.61958  0.77255  0.48576  0.95510
      2   2.04954  5.08679  5.67834  5.06512  4.18208  4.88890  5.22652  2.25141  4.85226  1.26868  2.52084  5.05125  5.25122  4.98454  4.86243  2.31641  2.38452  2.10726  5.71917  4.54321      2 l - - -
          2.68618  4.42225  2.77519  2.73123  3.46354  2.40513  3.72494  3.29354  2.67741  2.69355  4.24690  2.90347  2.73739  3.18146  2.89801  2.37887  2.77519  2.98518  4.58477  3.61503
          0.00299  6.20994  6.93228  0.61958  0.77255  0.48576  0.95510
      3   1.91236  2.26980  2.57201  3.35095  5.15667  4.37871  4.57567  4.59409  2.18906  2.07585  4.94534  2.43611  4.77010  3.70291  2.69845  2.89502  3.80214  2.52334  6.36365  5.00179      3 a - - -
          2.68618  4.42225  2.77519  2.73123  3.46354  2.40513  3.72494  3.29354  2.67741  2.69355  4.24690  2.90347  2.73739  3.18146  2.89801  2.37887  2.77519  2.98518  4.58477  3.61503
          0.00299  6.20994  6.93228  0.61958  0.77255  0.48576  0.95510
      4   3.56320  6.02585  2.14557  3.27440  2.50623  1.96385  4.53305  2.85825  1.80003  4.32297  5.07212  3.81910  2.73842  3.63612  2.41184  2.35997  3.79441  4.40636  6.47036  5.07179      4 k - - -
          2.68618  4.42225  2.77519  2.73123  3.46354  2.40513  3.72494  3.29354  2.67741  2.69355  4.24690  2.90347  2.73739  3.18146  2.89801  2.37887  2.77519  2.98518  4.58477  3.61503
          0.00299  6.20994  6.93228  0.61958  0.77255  0.48576  0.95510
      5   2.53166  6.01279  3.83328  2.27357  2.51209  4.34402  4.53368  4.80342  3.27806  2.61543  5.05985  2.41385  1.87547  2.37840  2.30334  3.53496  2.54571  4.39058  6.45997  5.06403      5 p - - -
          2.68618  4.42225  2.77519  2.73123  3.46354  2.40513  3.72494  3.29354  2.67741  2.69355  4.24690  2.90347  2.73739  3.18146  2.89801  2.37887  2.77519  2.98518  4.58477  3.61503
          0.00299  6.20994  6.93228  0.61958  0.77255  0.48576  0.95510
      6   2.51669  5.09753  2.43823  4.77505  2.45608  4.81364  2.21539  2.18575  4.61492  1.81688  4.21456  4.88387  5.18020  4.79504  4.71644  1.82271  3.90841  2.42281  5.71485  4.53164      6 l - - -
          2.68618  4.42225  2.77519  2.73123  3.46354  2.40513  3.72494  3.29354  2.67741  2.69355  4.24690  2.90347  2.73739  3.18146  2.89801  2.37887  2.77519  2.98518  4.58477  3.61503
          0.00299  6.20994  6.93228  0.61958  0.77255  0.48576  0.95510
      7   1.87170  5.49046  4.42773  3.87165  4.70622  2.50186  4.88596  4.07863  3.84074  1.99296  4.64683  4.30045  2.41298  2.32486  4.22982  1.63603  3.90422  2.45207  6.11509  4.86193      7 s - - -
          2.68618  4.42225  2.77519  2.73123  3.46354  2.40513  3.72494  3.29354  2.67741  2.69355  4.24690  2.90347  2.73739  3.18146  2.89801  2.37887  2.77519  2.98518  4.58477  3.61503
          0.00299  6.20994  6.93228  0.61958  0.77255  0.48576  0.95510
      8   2.52999  5.86813  3.92112  2.35559  5.13548  2.22005  4.58410  4.56915  3.36018  2.10275  4.93196  3.89433  4.77683  3.71493  1.86739  2.25578  2.30477  4.21666  6.35246  2.59026      8 r - - -
          2.68618  4.42225  2.77519  2.73123  3.46354  2.40513  3.72494  3.29354  2.67741  2.69355  4.24690  2.90347  2.73739  3.18146  2.89801  2.37887  2.77519  2.98518  4.58477  3.61503
          0.00299  6.20994  6.93228  0.61958  0.77255  0.48576  0.95510
      9   3.69212  5.11874  5.35675  2.50064  4.21454  4.82700  2.46149  1.68839  4.60337  2.40099  2.45967  4.88456  5.19268  2.39438  4.71653  4.12473  3.92422  1.42559  5.73834  4.55471      9 v - - -
          2.68618  4.42225  2.77519  2.73123  3.46354  2.40513  3.72494  3.29354  2.67741  2.69355  4.24690  2.90347  2.73739  3.18146  2.89801  2.37887  2.77519  2.98518  4.58477  3.61503
          0.00201  6.20896        *  0.61958  0.77255  0.00000        *
//
