/*

 HMM logo
 http://github.com/url/here
 Copyright 2013, Jody Clements.
 Licensed under the MIT License.
 http://url/to/license
*/
(function(c){function h(){if(!i){var a=document.createElement("canvas");i=!(!a.getContext||!a.getContext("2d"))}return i}function f(a){function e(b,a,e){b.beginPath();b.moveTo(0,a);b.lineTo(e,a);b.lineWidth=1;b.strokeStyle="#999999";b.stroke()}function g(b,a,e,g,c){c=c||"#999999";b.beginPath();b.moveTo(a,e);b.lineTo(a,e+g);b.lineWidth=1;b.strokeStyle=c;b.stroke()}function d(b,a,e,g,c,d,k,f){b.font=c+"px Arial";b.fillStyle=k;b.fillRect(a,e-10,d,14);b.textAlign="center";b.fillStyle=f;b.fillText(g,a+
d/2,e)}a=a||{};this.column_width=a.column_width||34;this.height=a.height||300;this.data=a.data||null;this.scale_height_enabled=a.height_toggle||null;this.zoom_enabled=a.zoom_buttons&&"disabled"===a.zoom_buttons?null:!0;this.alphabet=a.data.alphabet||"dna";this.dom_element=a.dom_element||c("body");this.called_on=a.called_on||null;this.start=a.start||1;this.end=a.end||this.data.height_arr.length;this.default_zoom=this.zoom=parseFloat(a.zoom)||0.4;this.data.max_height=a.scaled_max?a.data.max_height_obs||
this.data.max_height||2:a.data.max_height_theory||this.data.max_height||2;this.dna_colors={A:"#cbf751",C:"#5ec0cc",G:"#ffdf59",T:"#b51f16",U:"#b51f16"};this.aa_colors={A:"#FF9966",C:"#009999",D:"#FF0000",E:"#CC0033",F:"#00FF00",G:"#f2f20c",H:"#660033",I:"#CC9933",K:"#663300",L:"#FF9933",M:"#CC99CC",N:"#336666",P:"#0099FF",Q:"#6666CC",R:"#990000",S:"#0000FF",T:"#00FFFF",V:"#FFCC33",W:"#66CC66",Y:"#006600"};this.colors=this.dna_colors;"aa"===this.alphabet&&(this.colors=this.aa_colors);this.canvas_width=
5E3;this.scrollme=null;this.previous_target=0;this.rendered=[];this.previous_zoom=0;this.render=function(b){if(this.data){var b=b||{},a=b.zoom||this.zoom,e=b.target||1,g=c(this.dom_element).parent().width(),d=1,j=0;if(e!==this.previous_target){this.previous_target=e;b.start&&(this.start=b.start);b.end&&(this.end=b.end);0.1>=a?a=0.1:1<=a&&(a=1);this.zoom=a;var b=this.end||this.data.height_arr.length,k=this.start||1,b=b>this.data.height_arr.length?this.data.height_arr.length:b,b=b<k?k:b,k=k>b?b:k,k=
1<k?k:1;this.y=this.height-20;this.max_width=this.column_width*(b-k+1);g>this.max_width&&(a=1,this.zoom_enabled=!1);this.zoom=a;this.zoomed_column=this.column_width*a;this.total_width=this.zoomed_column*(b-k+1);if(1>a)for(;this.total_width<g&&!(this.zoom+=0.1,this.zoomed_column=this.column_width*this.zoom,this.total_width=this.zoomed_column*(b-k+1),this.zoom_enabled=!1,1<=a););e>this.total_width&&(e=this.total_width);c(this.dom_element).attr({width:this.total_width+"px"}).css({width:this.total_width+
"px"});g=Math.ceil(this.total_width/this.canvas_width);this.columns_per_canvas=Math.ceil(this.canvas_width/this.zoomed_column);this.previous_zoom!==this.zoom&&(c(this.dom_element).find("canvas").remove(),this.previous_zoom=this.zoom,this.rendered=[]);this.canvases=[];this.contexts=[];for(j=0;j<g;j++){var f=this.columns_per_canvas*j+k,m=f+this.columns_per_canvas-1;m>b&&(m=b);var n=(m-f+1)*this.zoomed_column;n>d&&(d=n);var p=d*j,s=p+n;if(e<s+s/2&&e>p-p/2&&1!==this.rendered[j]){var p=this.canvases,i=
j,r=this.dom_element,t=this.height,x=n,A=j,B=d,u=c(r).find("#canv_"+A);u.length||(c(r).append('<canvas class="canvas_logo" id="canv_'+A+'"  height="'+t+'" width="'+x+'" style="left:'+B*A+'px"></canvas>'),u=c(r).find("#canv_"+A));c(u).attr("width",x).attr("height",t);h()||(u[0]=G_vmlCanvasManager.initElement(u[0]));p[i]=u[0];this.contexts[j]=this.canvases[j].getContext("2d");this.contexts[j].setTransform(1,0,0,1,0,0);this.contexts[j].clearRect(0,0,n,this.height);this.contexts[j].fillStyle="#ffffff";
this.contexts[j].fillRect(0,0,s,this.height);12<this.zoomed_column?(n=parseInt(10*a,10),n=10<n?10:n,this.render_with_text(f,m,j,n)):this.render_with_rects(f,m,j);this.rendered[j]=1}}!this.scrollme&&h()&&(this.scrollme=new EasyScroller(c(this.dom_element)[0],{scrollingX:1,scrollingY:0,eventTarget:this.called_on}));1!==e&&h()&&this.scrollme.reflow()}}};this.render_x_axis_label=function(){c(this.dom_element).parent().before('<div class="logo_xaxis" class="centered" style="margin-left:40px"><p class="xaxis_text" style="width:10em;margin:1em auto">Model Position</p></div>')};
this.render_y_axis_label=function(){c(this.dom_element).parent().before('<canvas class="logo_yaxis" height="300" width="40"></canvas>');var b=c(this.called_on).find(".logo_yaxis");Math.abs(this.data.max_height);h()||(b[0]=G_vmlCanvasManager.initElement(b[0]));b=b[0].getContext("2d");b.beginPath();b.moveTo(40,1);b.lineTo(30,1);b.moveTo(40,271);b.lineTo(30,271);b.moveTo(40,135.5);b.lineTo(30,135.5);b.lineWidth=1;b.strokeStyle="#666666";b.stroke();b.fillStyle="#666666";b.textAlign="right";b.font="bold 10px Arial";
b.textBaseline="top";b.fillText(this.data.max_height.toFixed(1),28,0);b.textBaseline="middle";b.fillText(parseFloat(this.data.max_height/2).toFixed(1),28,135.5);b.fillText("0",28,271);b.save();b.translate(5,this.height/2);b.rotate(-Math.PI/2);b.textAlign="center";b.font="normal 12px Arial";b.fillText("Information Content",1,0);b.restore()};this.render_x_axis_label();this.render_y_axis_label();this.render_with_text=function(b,a,c,f){var l=0,j=b,k=0,k=Math.abs(this.data.max_height)+Math.abs(this.data.min_height_obs),
k=Math.round(100*Math.abs(this.data.max_height)/k);Math.round(271*k/100);a+3<=this.end&&(a+=3);for(k=b;k<=a;k++){if(this.data.mmline&&1===this.data.mmline[k-1])this.contexts[c].fillStyle="#cccccc",this.contexts[c].fillRect(l,10,this.zoomed_column,this.height-40);else if(b=this.data.height_arr[k-1])for(var q=0,m=b.length,n=0,n=0;n<m;n++){var p=b[n].split(":",2),s=l+this.zoomed_column/2,i=(0.0024*this.zoomed_column+0.0405).toFixed(2),r=null;if(0.01<p[1]){var r=parseFloat(p[1])/this.data.max_height,
t=269-q,x=258*r;h()||(t+=x*(r/2));this.contexts[c].font="bold 350px Arial";this.contexts[c].textAlign="center";this.contexts[c].fillStyle=this.colors[p[0]];this.contexts[c].transform(i,0,0,r,s,t);this.contexts[c].fillText(p[0],0,0);this.contexts[c].setTransform(1,0,0,1,0,0);q+=x}}g(this.contexts[c],l,this.height-15,5);g(this.contexts[c],l,this.height-30,5);0.7>this.zoom?0===k%5&&this.draw_column_divider({context_num:c,x:l,fontsize:10,column_num:j,ralign:!0}):this.draw_column_divider({context_num:c,
x:l,fontsize:f,column_num:j});b=this.contexts[c];q=l;m=this.height;n=this.zoomed_column;p=this.data.insert_probs[k-1]/100;s=m-20;i="#ffffff";r="#000000";0.1<p?(i="#d7301f",r="#ffffff"):0.05<p?i="#fc8d59":0.03<p&&(i="#fdcc8a");d(b,q,s,p,f,n,i,r);0.1<p&&g(b,q+n,m-30,-30-m,i);b=this.data.insert_lengths[k-1];q="#ffffff";m="#000000";9<b?(q="#2171b5",m="#ffffff"):7<b?q="#6baed6":4<b&&(q="#bdd7e7");d(this.contexts[c],l,this.height-5,b,f,this.zoomed_column,q,m);l+=this.zoomed_column;j++}e(this.contexts[c],
this.height-15,this.total_width);e(this.contexts[c],this.height-30,this.total_width);e(this.contexts[c],0,this.total_width)};this.draw_column_divider=function(b){var a=b.ralign?b.x+this.zoomed_column:b.x,e=b.ralign?b.x+2:b.x;g(this.contexts[b.context_num],a,this.height-30,-30-this.height,"#dddddd");g(this.contexts[b.context_num],a,0,5);var a=this.contexts[b.context_num],c=this.zoomed_column,d=b.column_num,j=b.ralign;a.font=b.fontsize+"px Arial";a.textAlign=j?"right":"center";a.fillStyle="#666666";
a.fillText(d,e+c/2,10)};this.render_with_rects=function(b,a,c){var d=0,f=b,j=0,j=Math.abs(this.data.max_height),k=Math.abs(this.data.min_height_obs),j=Math.round(100*Math.abs(this.data.max_height)/(j+k));Math.round(271*j/100);k=10;for(j=b;j<=a;j++){if(this.data.mmline&&1===this.data.mmline[j-1])this.contexts[c].fillStyle="#cccccc",this.contexts[c].fillRect(d,10,this.zoomed_column,this.height-40);else for(var b=this.data.height_arr[j-1],h=0,m=b.length,n=0,n=0;n<m;n++){var p=b[n].split(":",2);if(0.01<
p[1]){var i=parseFloat(p[1])/this.data.max_height,w=d,i=271*i,r=271-h-i;this.contexts[c].fillStyle=this.colors[p[0]];this.contexts[c].fillRect(w,r,this.zoomed_column,i);h+=i}}0.2>this.zoom?k=20:0.3>this.zoom&&(k=10);0===j%k&&(g(this.contexts[c],d+this.zoomed_column,this.height-30,parseFloat(this.height),"#dddddd"),g(this.contexts[c],d+this.zoomed_column,0,5),b=this.contexts[c],h=d-2,m=this.zoomed_column,n=f,b.font="10px Arial",b.textAlign="right",b.fillStyle="#666666",b.fillText(n,h+m/2,10));b=this.contexts[c];
h=d;m=this.height-28;n=this.zoomed_column;p=this.data.insert_probs[j-1]/100;w=this.data.insert_lengths[j-1];i="#ffffff";0.1<p?i="#d7301f":0.05<p?i="#fc8d59":0.03<p&&(i="#fdcc8a");b.fillStyle=i;b.fillRect(h,m,n,10);i="#ffffff";9<w?i="#2171b5":7<w?i="#6baed6":4<w&&(i="#bdd7e7");b.fillStyle=i;b.fillRect(h,m+12,n,10);e(this.contexts[c],this.height-30,this.total_width);e(this.contexts[c],0,this.total_width);d+=this.zoomed_column;f++}};this.toggle_scale=function(){var b=this.current_column();this.data.max_height=
this.data.max_height===this.data.max_height_obs?this.data.max_height_theory:this.data.max_height_obs;this.rendered=[];c(this.called_on).find(".logo_yaxis").remove();this.render_y_axis_label();this.scrollme.reflow();this.scrollToColumn(b+1);this.scrollToColumn(b)};this.current_column=function(){var b=this.scrollme.scroller.getValues().left,a=this.column_width*this.zoom,b=b/a,a=c(this.called_on).find(".logo_container").width()/a/2;return Math.ceil(b+a)};this.change_zoom=function(b){var a=0.3;b.target?
a=b.target:b.distance&&(a=(parseFloat(this.zoom)-parseFloat(b.distance)).toFixed(1),"+"===b.direction&&(a=(parseFloat(this.zoom)+parseFloat(b.distance)).toFixed(1)));1<a?a=1:0.1>a&&(a=0.1);c(this.called_on).find(".logo_graphic").width()*a/this.zoom>c(this.called_on).find(".logo_container").width()&&(b.column?(this.zoom=a,this.render({zoom:this.zoom}),this.scrollme.reflow(),a=this.coordinatesFromColumn(b.column),this.scrollme.scroller.scrollTo(a-b.offset)):(b=this.current_column(),this.zoom=a,this.render({zoom:this.zoom}),
this.scrollme.reflow(),this.scrollToColumn(b)));return this.zoom};this.columnFromCoordinates=function(b){return Math.ceil(b/(this.column_width*this.zoom))};this.coordinatesFromColumn=function(b){return(b-1)*this.column_width*this.zoom+this.column_width*this.zoom/2};this.scrollToColumn=function(b,a){var e=c(this.called_on).find(".logo_container").width()/2,d=this.coordinatesFromColumn(b);this.scrollme.scroller.scrollTo(d-e,0,a)}}var i=null;c.fn.hmm_logo=function(a){var e=null,g=c('<div class="logo_graphic">');
if(h()){a=a||{};c(this).append(c('<div class="logo_container">').append(g).append('<div class="logo_divider">'));a.data=c(this).data("logo");a.dom_element=g;a.called_on=this;var d=c('<form class="logo_form"><fieldset><label for="position">Column number</label><input type="text" name="position" class="logo_position"></input><button class="button logo_change">Go</button></fieldset></form>'),e=new f(a);e.render(a);e.scale_height_enabled&&e.data.max_height_obs<e.data.max_height_theory&&d.append('<button class="logo_scale button">Toggle Scale</button><br/>');
e.zoom_enabled&&d.append('<button class="logo_zoomout button">-</button><button class="logo_zoomin button">+</button>');c(this).append(d);c(this).find(".logo_reset").bind("click",function(b){b.preventDefault();b=e;b.change_zoom({target:b.default_zoom})});c(this).find(".logo_change").bind("click",function(b){b.preventDefault()});c(this).find(".logo_zoomin").bind("click",function(b){b.preventDefault();e.change_zoom({distance:0.1,direction:"+"})});c(this).find(".logo_zoomout").bind("click",function(b){b.preventDefault();
e.change_zoom({distance:0.1,direction:"-"})});c(this).find(".logo_scale").bind("click",function(b){b.preventDefault();e.toggle_scale()});c(this).find(".logo_position").bind("change",function(){var b=e;this.value.match(/^\d+$/m)&&b.scrollToColumn(this.value,1)});g.bind("dblclick",function(b){var a=e,d=c(this).offset(),d=parseInt(b.pageX-d.left,10),b=b.pageX-c(this).parent().offset().left,d=a.columnFromCoordinates(d);1>a.zoom?a.change_zoom({target:1,offset:b,column:d}):a.change_zoom({target:0.3,offset:b,
column:d})});a.column_info&&g.bind("click",function(b){var d=e,g=c("<table><tr><th>Letter</th><th>score</th></tr></table>"),f=c(this).offset(),b=parseInt(b.pageX-f.left,10);c(this).parent().offset();d=d.columnFromCoordinates(b);c.each(e.data.height_arr[d-1].reverse(),function(){var b=this.split(":",2);g.append("<tr><td>"+b[0]+"</td><td>"+b[1]+"</td></tr>")});c(a.column_info).empty().append(g)});c(document).bind(this.attr("id")+".scrolledTo",function(b,a){e.render({target:a})});c(document).keydown(function(b){b.ctrlKey||
((61===b.which||107===b.which)&&e.change_zoom({distance:0.1,direction:"+"}),(109===b.which||0===b.which)&&e.change_zoom({distance:0.1,direction:"-"}))})}else c("#logo").replaceWith(c("#no_canvas").html());return e}})(jQuery);/*

 Scroller
 http://github.com/zynga/scroller

 Copyright 2011, Zynga Inc.
 Licensed under the MIT License.
 https://raw.github.com/zynga/scroller/master/MIT-LICENSE.txt

 Based on the work of: Unify Project (unify-project.org)
 http://unify-project.org
 Copyright 2011, Deutsche Telekom AG
 License: MIT + Apache (V2)

 Inspired by: https://github.com/inexorabletash/raf-shim/blob/master/raf.js
*/
(function(c){if(!c.requestAnimationFrame){var h=Date.now||function(){return+new Date},f=Object.keys||function(b){var a={},e;for(e in b)a[e]=!0;return a},i=Object.empty||function(b){for(var a in b)return!1;return!0},a;a:{a=["webkit","moz","o","ms"];for(var e=0;4>e;e++)if(null!=c[a[e]+"RequestAnimationFrame"]){a=a[e];break a}a=void 0}if(a)c.requestAnimationFrame=c[a+"RequestAnimationFrame"],c.cancelRequestAnimationFrame=c[a+"CancelRequestAnimationFrame"];else{var g={},d=1,b=null;c.requestAnimationFrame=
function(a){var e=d++;g[e]=a;null===b&&(b=setTimeout(function(){var a=h(),e=g,c=f(e);g={};b=null;for(var d=0,i=c.length;d<i;d++)e[c[d]](a)},1E3/60));return e};c.cancelRequestAnimationFrame=function(a){delete g[a];i(g)&&(clearTimeout(b),b=null)}}}})(this);
(function(c){var h=Date.now||function(){return+new Date},f={},i=1;c.core?core.effect||(core.effect={}):c.core={effect:{}};core.effect.Animate={stop:function(a){var e=null!=f[a];e&&(f[a]=null);return e},isRunning:function(a){return null!=f[a]},start:function(a,e,c,d,b,y){var z=h(),v=z,l=0,j=0,k=i++;y||(y=document.body);if(0===k%20){var q={},m;for(m in f)q[m]=!0;f=q}var n=function(i){var i=!0!==i,m=h();if(!f[k]||e&&!e(k))f[k]=null,c&&c(60-j/((m-z)/1E3),k,!1);else{if(i)for(var q=Math.round((m-v)/(1E3/
60))-1,r=0;r<Math.min(q,4);r++)n(!0),j++;d&&(l=(m-z)/d,1<l&&(l=1));q=b?b(l):l;(!1===a(q,m,i)||1===l)&&i?(f[k]=null,c&&c(60-j/((m-z)/1E3),k,1===l||null==d)):i&&(v=m,requestAnimationFrame(n,y))}};f[k]=!0;requestAnimationFrame(n,y);return k}}})(this);
var EasyScroller=function(c,h){this.content=c;this.container=c.parentNode;this.options=h||{};var f=this;this.scroller=new Scroller(function(c,a,e){f.render(c,a,e)},h);this.bindEvents();this.content.style[EasyScroller.vendorPrefix+"TransformOrigin"]="left top";this.reflow()};
EasyScroller.prototype.render=function(){var c=document.documentElement.style,h;window.opera&&"[object Opera]"===Object.prototype.toString.call(opera)?h="presto":"MozAppearance"in c?h="gecko":"WebkitAppearance"in c?h="webkit":"string"===typeof navigator.cpuClass&&(h="trident");c=EasyScroller.vendorPrefix={trident:"ms",gecko:"Moz",webkit:"Webkit",presto:"O"}[h];h=document.createElement("div");var f=c+"Transform";return void 0!==h.style[c+"Perspective"]?function(c,a,e){this.content.style[f]="translate3d("+
-c+"px,"+-a+"px,0) scale("+e+")"}:void 0!==h.style[f]?function(c,a,e){this.content.style[f]="translate("+-c+"px,"+-a+"px) scale("+e+")"}:function(c,a,e){this.content.style.marginLeft=c?-c/e+"px":"";this.content.style.marginTop=a?-a/e+"px":"";this.content.style.zoom=e||""}}();
EasyScroller.prototype.reflow=function(){this.scroller.setDimensions(this.container.clientWidth,this.container.clientHeight,this.content.offsetWidth,this.content.offsetHeight);var c=this.container.getBoundingClientRect();this.scroller.setPosition(c.left+this.container.clientLeft,c.top+this.container.clientTop)};
EasyScroller.prototype.bindEvents=function(){var c=this;$(window).bind("resize",function(){c.reflow()});$("#modelTab").bind("click",function(){c.reflow()});if("ontouchstart"in window)this.container.addEventListener("touchstart",function(f){if(!f.touches[0]||!f.touches[0].target||!f.touches[0].target.tagName.match(/input|textarea|select/i))c.scroller.doTouchStart(f.touches,(new Date).getTime()),f.preventDefault()},!1),document.addEventListener("touchmove",function(f){c.scroller.doTouchMove(f.touches,
(new Date).getTime(),f.scale)},!1),document.addEventListener("touchend",function(){c.scroller.doTouchEnd((new Date).getTime())},!1),document.addEventListener("touchcancel",function(){c.scroller.doTouchEnd((new Date).getTime())},!1);else{var h=!1;$(this.container).bind("mousedown",function(f){f.target.tagName.match(/input|textarea|select/i)||(c.scroller.doTouchStart([{pageX:f.pageX,pageY:f.pageY}],(new Date).getTime()),h=!0,f.preventDefault())});$(document).bind("mousemove",function(f){h&&(c.scroller.doTouchMove([{pageX:f.pageX,
pageY:f.pageY}],(new Date).getTime()),h=!0)});$(document).bind("mouseup",function(){h&&(c.scroller.doTouchEnd((new Date).getTime()),h=!1)});$(this.container).bind("mousewheel",function(f){c.options.zooming&&(c.scroller.doMouseZoom(f.wheelDelta,(new Date).getTime(),f.pageX,f.pageY),f.preventDefault())})}};var Scroller;
(function(){Scroller=function(a,e){this.__callback=a;this.options={scrollingX:!0,scrollingY:!0,animating:!0,bouncing:!0,locking:!0,paging:!1,snapping:!1,zooming:!1,minZoom:0.5,maxZoom:3,eventTarget:null};for(var c in e)this.options[c]=e[c]};var c=function(a){return Math.pow(a-1,3)+1},h=function(a){return 1>(a/=0.5)?0.5*Math.pow(a,3):0.5*(Math.pow(a-2,3)+2)},f={__isSingleTouch:!1,__isTracking:!1,__isGesturing:!1,__isDragging:!1,__isDecelerating:!1,__isAnimating:!1,__clientLeft:0,__clientTop:0,__clientWidth:0,
__clientHeight:0,__contentWidth:0,__contentHeight:0,__snapWidth:100,__snapHeight:100,__refreshHeight:null,__refreshActive:!1,__refreshActivate:null,__refreshDeactivate:null,__refreshStart:null,__zoomLevel:1,__scrollLeft:0,__scrollTop:0,__maxScrollLeft:0,__maxScrollTop:0,__scheduledLeft:0,__scheduledTop:0,__scheduledZoom:0,__lastTouchLeft:null,__lastTouchTop:null,__lastTouchMove:null,__positions:null,__minDecelerationScrollLeft:null,__minDecelerationScrollTop:null,__maxDecelerationScrollLeft:null,
__maxDecelerationScrollTop:null,__decelerationVelocityX:null,__decelerationVelocityY:null,setDimensions:function(a,e,c,d){a&&(this.__clientWidth=a);e&&(this.__clientHeight=e);c&&(this.__contentWidth=c);d&&(this.__contentHeight=d);this.__computeScrollMax();this.scrollTo(this.__scrollLeft,this.__scrollTop,!0)},setPosition:function(a,e){this.__clientLeft=a||0;this.__clientTop=e||0},setSnapSize:function(a,e){this.__snapWidth=a;this.__snapHeight=e},activatePullToRefresh:function(a,e,c,d){this.__refreshHeight=
a;this.__refreshActivate=e;this.__refreshDeactivate=c;this.__refreshStart=d},finishPullToRefresh:function(){this.__refreshActive=!1;this.__refreshDeactivate&&this.__refreshDeactivate();this.scrollTo(this.__scrollLeft,this.__scrollTop,!0)},getValues:function(){return{left:this.__scrollLeft,top:this.__scrollTop,zoom:this.__zoomLevel}},getScrollMax:function(){return{left:this.__maxScrollLeft,top:this.__maxScrollTop}},zoomTo:function(a,e,c,d){if(!this.options.zooming)throw Error("Zooming is not enabled!");
this.__isDecelerating&&(core.effect.Animate.stop(this.__isDecelerating),this.__isDecelerating=!1);var b=this.__zoomLevel;null==c&&(c=this.__clientWidth/2);null==d&&(d=this.__clientHeight/2);a=Math.max(Math.min(a,this.options.maxZoom),this.options.minZoom);this.__computeScrollMax(a);c=(c+this.__scrollLeft)*a/b-c;d=(d+this.__scrollTop)*a/b-d;c>this.__maxScrollLeft?c=this.__maxScrollLeft:0>c&&(c=0);d>this.__maxScrollTop?d=this.__maxScrollTop:0>d&&(d=0);this.__publish(c,d,a,e)},zoomBy:function(a,c,g,
d){this.zoomTo(this.__zoomLevel*a,c,g,d)},scrollTo:function(a,c,g,d){$(document).trigger(this.options.eventTarget.attr("id")+".scrolledTo",[a,c,d]);this.__isDecelerating&&(core.effect.Animate.stop(this.__isDecelerating),this.__isDecelerating=!1);if(null!=d&&d!==this.__zoomLevel){if(!this.options.zooming)throw Error("Zooming is not enabled!");a*=d;c*=d;this.__computeScrollMax(d)}else d=this.__zoomLevel;this.options.scrollingX?this.options.paging?a=Math.round(a/this.__clientWidth)*this.__clientWidth:
this.options.snapping&&(a=Math.round(a/this.__snapWidth)*this.__snapWidth):a=this.__scrollLeft;this.options.scrollingY?this.options.paging?c=Math.round(c/this.__clientHeight)*this.__clientHeight:this.options.snapping&&(c=Math.round(c/this.__snapHeight)*this.__snapHeight):c=this.__scrollTop;a=Math.max(Math.min(this.__maxScrollLeft,a),0);c=Math.max(Math.min(this.__maxScrollTop,c),0);a===this.__scrollLeft&&c===this.__scrollTop&&(g=!1);this.__publish(a,c,d,g)},scrollBy:function(a,c,g){this.scrollTo((this.__isAnimating?
this.__scheduledLeft:this.__scrollLeft)+(a||0),(this.__isAnimating?this.__scheduledTop:this.__scrollTop)+(c||0),g)},doMouseZoom:function(a,c,g,d){return this.zoomTo(this.__zoomLevel*(0<a?0.97:1.03),!1,g-this.__clientLeft,d-this.__clientTop)},doTouchStart:function(a,c){if(null==a.length)throw Error("Invalid touch list: "+a);c instanceof Date&&(c=c.valueOf());if("number"!==typeof c)throw Error("Invalid timestamp value: "+c);this.__isDecelerating&&(core.effect.Animate.stop(this.__isDecelerating),this.__isDecelerating=
!1);this.__isAnimating&&(core.effect.Animate.stop(this.__isAnimating),this.__isAnimating=!1);var g,d,b=1===a.length;b?(g=a[0].pageX,d=a[0].pageY):(g=Math.abs(a[0].pageX+a[1].pageX)/2,d=Math.abs(a[0].pageY+a[1].pageY)/2);this.__initialTouchLeft=g;this.__initialTouchTop=d;this.__zoomLevelStart=this.__zoomLevel;this.__lastTouchLeft=g;this.__lastTouchTop=d;this.__lastTouchMove=c;this.__lastScale=1;this.__enableScrollX=!b&&this.options.scrollingX;this.__enableScrollY=!b&&this.options.scrollingY;this.__isTracking=
!0;this.__isDragging=!b;this.__isSingleTouch=b;this.__positions=[]},doTouchMove:function(a,c,g){if(null==a.length)throw Error("Invalid touch list: "+a);c instanceof Date&&(c=c.valueOf());if("number"!==typeof c)throw Error("Invalid timestamp value: "+c);if(this.__isTracking){var d;2===a.length?(d=Math.abs(a[0].pageX+a[1].pageX)/2,a=Math.abs(a[0].pageY+a[1].pageY)/2):(d=a[0].pageX,a=a[0].pageY);var b=this.__positions;if(this.__isDragging){var f=d-this.__lastTouchLeft,i=a-this.__lastTouchTop,h=this.__scrollLeft,
l=this.__scrollTop,j=this.__zoomLevel;if(null!=g&&this.options.zooming){var k=j,j=j/this.__lastScale*g,j=Math.max(Math.min(j,this.options.maxZoom),this.options.minZoom);if(k!==j){var q=d-this.__clientLeft,m=a-this.__clientTop,h=(q+h)*j/k-q,l=(m+l)*j/k-m;this.__computeScrollMax(j)}}if(this.__enableScrollX&&(h-=f,k=this.__maxScrollLeft,h>k||0>h))h=this.options.bouncing?h+f/2:h>k?k:0;if(this.__enableScrollY&&(l-=i,f=this.__maxScrollTop,l>f||0>l))this.options.bouncing?(l+=i/2,!this.__enableScrollX&&null!=
this.__refreshHeight&&(!this.__refreshActive&&l<=-this.__refreshHeight?(this.__refreshActive=!0,this.__refreshActivate&&this.__refreshActivate()):this.__refreshActive&&l>-this.__refreshHeight&&(this.__refreshActive=!1,this.__refreshDeactivate&&this.__refreshDeactivate()))):l=l>f?f:0;60<b.length&&b.splice(0,30);b.push(h,l,c);this.__publish(h,l,j)}else i=this.options.locking?3:0,h=Math.abs(d-this.__initialTouchLeft),l=Math.abs(a-this.__initialTouchTop),this.__enableScrollX=this.options.scrollingX&&
h>=i,this.__enableScrollY=this.options.scrollingY&&l>=i,b.push(this.__scrollLeft,this.__scrollTop,c),this.__isDragging=(this.__enableScrollX||this.__enableScrollY)&&(5<=h||5<=l);this.__lastTouchLeft=d;this.__lastTouchTop=a;this.__lastTouchMove=c;this.__lastScale=g}},doTouchEnd:function(a){a instanceof Date&&(a=a.valueOf());if("number"!==typeof a)throw Error("Invalid timestamp value: "+a);if(this.__isTracking){this.__isTracking=!1;if(this.__isDragging&&(this.__isDragging=!1,this.__isSingleTouch&&this.options.animating&&
100>=a-this.__lastTouchMove)){for(var c=this.__positions,g=c.length-1,d=g,b=g;0<b&&c[b]>this.__lastTouchMove-100;b-=3)d=b;if(d!==g&&(g=c[g]-c[d],b=this.__scrollTop-c[d-1],this.__decelerationVelocityX=(this.__scrollLeft-c[d-2])/g*(1E3/60),this.__decelerationVelocityY=b/g*(1E3/60),c=this.options.paging||this.options.snapping?4:1,Math.abs(this.__decelerationVelocityX)>c||Math.abs(this.__decelerationVelocityY)>c))this.__refreshActive||this.__startDeceleration(a)}this.__isDecelerating||(this.__refreshActive&&
this.__refreshStart?(this.__publish(this.__scrollLeft,-this.__refreshHeight,this.__zoomLevel,!0),this.__refreshStart&&this.__refreshStart()):(this.scrollTo(this.__scrollLeft,this.__scrollTop,!0,this.__zoomLevel),this.__refreshActive&&(this.__refreshActive=!1,this.__refreshDeactivate&&this.__refreshDeactivate())));this.__positions.length=0}},__publish:function(a,e,g,d){var b=this,f=b.__isAnimating;f&&(core.effect.Animate.stop(f),b.__isAnimating=!1);if(d&&b.options.animating){b.__scheduledLeft=a;b.__scheduledTop=
e;b.__scheduledZoom=g;var i=b.__scrollLeft,v=b.__scrollTop,l=b.__zoomLevel,j=a-i,k=e-v,q=g-l;b.__isAnimating=core.effect.Animate.start(function(a,c,d){d&&(b.__scrollLeft=i+j*a,b.__scrollTop=v+k*a,b.__zoomLevel=l+q*a,b.__callback&&b.__callback(b.__scrollLeft,b.__scrollTop,b.__zoomLevel))},function(a){return b.__isAnimating===a},function(a,c){c===b.__isAnimating&&(b.__isAnimating=!1);b.options.zooming&&b.__computeScrollMax()},250,f?c:h)}else b.__scheduledLeft=b.__scrollLeft=a,b.__scheduledTop=b.__scrollTop=
e,b.__scheduledZoom=b.__zoomLevel=g,b.__callback&&b.__callback(a,e,g),b.options.zooming&&b.__computeScrollMax()},__computeScrollMax:function(a){null==a&&(a=this.__zoomLevel);this.__maxScrollLeft=Math.max(this.__contentWidth*a-this.__clientWidth,0);this.__maxScrollTop=Math.max(this.__contentHeight*a-this.__clientHeight,0)},__startDeceleration:function(){var a=this;if(a.options.paging){var c=Math.max(Math.min(a.__scrollLeft,a.__maxScrollLeft),0),g=Math.max(Math.min(a.__scrollTop,a.__maxScrollTop),0),
d=a.__clientWidth,b=a.__clientHeight;a.__minDecelerationScrollLeft=Math.floor(c/d)*d;a.__minDecelerationScrollTop=Math.floor(g/b)*b;a.__maxDecelerationScrollLeft=Math.ceil(c/d)*d;a.__maxDecelerationScrollTop=Math.ceil(g/b)*b}else a.__minDecelerationScrollLeft=0,a.__minDecelerationScrollTop=0,a.__maxDecelerationScrollLeft=a.__maxScrollLeft,a.__maxDecelerationScrollTop=a.__maxScrollTop;var f=a.options.snapping?4:0.1;a.__isDecelerating=core.effect.Animate.start(function(b,c,d){a.__stepThroughDeceleration(d)},
function(){return Math.abs(a.__decelerationVelocityX)>=f||Math.abs(a.__decelerationVelocityY)>=f},function(){a.__isDecelerating=!1;a.scrollTo(a.__scrollLeft,a.__scrollTop,a.options.snapping)})},__stepThroughDeceleration:function(a){var c=this.__scrollLeft+this.__decelerationVelocityX,f=this.__scrollTop+this.__decelerationVelocityY;if(!this.options.bouncing){var d=Math.max(Math.min(this.__maxScrollLeft,c),0);d!==c&&(c=d,this.__decelerationVelocityX=0);d=Math.max(Math.min(this.__maxScrollTop,f),0);
d!==f&&(f=d,this.__decelerationVelocityY=0)}a?this.__publish(c,f,this.__zoomLevel):(this.__scrollLeft=c,this.__scrollTop=f);this.options.paging||(this.__decelerationVelocityX*=0.95,this.__decelerationVelocityY*=0.95);this.options.bouncing&&(d=a=0,c<this.__minDecelerationScrollLeft?a=this.__minDecelerationScrollLeft-c:c>this.__maxDecelerationScrollLeft&&(a=this.__maxDecelerationScrollLeft-c),f<this.__minDecelerationScrollTop?d=this.__minDecelerationScrollTop-f:f>this.__maxDecelerationScrollTop&&(d=
this.__maxDecelerationScrollTop-f),0!==a&&(this.__decelerationVelocityX=0>=a*this.__decelerationVelocityX?this.__decelerationVelocityX+0.03*a:0.08*a),0!==d&&(this.__decelerationVelocityY=0>=d*this.__decelerationVelocityY?this.__decelerationVelocityY+0.03*d:0.08*d))}},i;for(i in f)Scroller.prototype[i]=f[i]})();
