/*

 HMM logo
 http://github.com/url/here
 Copyright 2013, Jody Clements.
 Licensed under the MIT License.
 http://url/to/license
*/
(function(c){function l(){if(!h){var b=document.createElement("canvas");h=!(!b.getContext||!b.getContext("2d"))}return h}function e(b){function f(a,b,f){a.beginPath();a.moveTo(0,b);a.lineTo(f,b);a.lineWidth=1;a.strokeStyle="#999999";a.stroke()}function k(a,b,f,k,c){c=c||"#999999";a.beginPath();a.moveTo(b,f);a.lineTo(b,f+k);a.lineWidth=1;a.strokeStyle=c;a.stroke()}function d(a,b,f,k,c,d,g,e){a.font=c+"px Arial";a.fillStyle=g;a.fillRect(b,f-10,d,14);a.textAlign="center";a.fillStyle=e;a.fillText(k,b+
d/2,f)}b=b||{};this.column_width=b.column_width||34;this.height=b.height||300;this.data=b.data||null;this.scale_height_enabled=b.height_toggle||null;this.zoom_enabled=b.zoom_buttons&&"disabled"===b.zoom_buttons?null:!0;this.alphabet=b.data.alphabet||"dna";this.dom_element=b.dom_element||c("body");this.called_on=b.called_on||null;this.start=b.start||1;this.end=b.end||this.data.height_arr.length;this.default_zoom=this.zoom=parseFloat(b.zoom)||0.4;this.data.max_height=b.scaled_max?b.data.max_height_obs||
this.data.max_height||2:b.data.max_height_theory||this.data.max_height||2;this.dna_colors={A:"#cbf751",C:"#5ec0cc",G:"#ffdf59",T:"#b51f16",U:"#b51f16"};this.aa_colors={A:"#FF9966",C:"#009999",D:"#FF0000",E:"#CC0033",F:"#00FF00",G:"#f2f20c",H:"#660033",I:"#CC9933",K:"#663300",L:"#FF9933",M:"#CC99CC",N:"#336666",P:"#0099FF",Q:"#6666CC",R:"#990000",S:"#0000FF",T:"#00FFFF",V:"#FFCC33",W:"#66CC66",Y:"#006600"};this.colors=this.dna_colors;"aa"===this.alphabet&&(this.colors=this.aa_colors);this.canvas_width=
5E3;this.scrollme=null;this.previous_target=0;this.rendered=[];this.previous_zoom=0;this.render=function(a){if(this.data){var a=a||{},b=a.zoom||this.zoom,f=a.target||1,k=c(this.dom_element).parent().width(),d=1,i=0;if(f!==this.previous_target){this.previous_target=f;a.start&&(this.start=a.start);a.end&&(this.end=a.end);0.1>=b?b=0.1:1<=b&&(b=1);this.zoom=b;var a=this.end||this.data.height_arr.length,g=this.start||1,a=a>this.data.height_arr.length?this.data.height_arr.length:a,a=a<g?g:a,g=g>a?a:g,g=
1<g?g:1;this.y=this.height-20;this.max_width=this.column_width*(a-g+1);k>this.max_width&&(b=1,this.zoom_enabled=!1);this.zoom=b;this.zoomed_column=this.column_width*b;this.total_width=this.zoomed_column*(a-g+1);if(1>b)for(;this.total_width<k&&!(this.zoom+=0.1,this.zoomed_column=this.column_width*this.zoom,this.total_width=this.zoomed_column*(a-g+1),this.zoom_enabled=!1,1<=b););f>this.total_width&&(f=this.total_width);c(this.dom_element).attr({width:this.total_width+"px"}).css({width:this.total_width+
"px"});k=Math.ceil(this.total_width/this.canvas_width);this.columns_per_canvas=Math.ceil(this.canvas_width/this.zoomed_column);this.previous_zoom!==this.zoom&&(c(this.dom_element).find("canvas").remove(),this.previous_zoom=this.zoom,this.rendered=[]);this.canvases=[];this.contexts=[];for(i=0;i<k;i++){var e=this.columns_per_canvas*i+g,m=e+this.columns_per_canvas-1;m>a&&(m=a);var n=(m-e+1)*this.zoomed_column;n>d&&(d=n);var r=d*i,t=r+n;if(f<t+t/2&&f>r-r/2&&1!==this.rendered[i]){var r=this.canvases,h=
i,p=this.dom_element,u=this.height,x=n,z=i,A=d,v=c(p).find("#canv_"+z);v.length||(c(p).append('<canvas class="canvas_logo" id="canv_'+z+'"  height="'+u+'" width="'+x+'" style="left:'+A*z+'px"></canvas>'),v=c(p).find("#canv_"+z));c(v).attr("width",x).attr("height",u);l()||(v[0]=G_vmlCanvasManager.initElement(v[0]));r[h]=v[0];this.contexts[i]=this.canvases[i].getContext("2d");this.contexts[i].setTransform(1,0,0,1,0,0);this.contexts[i].clearRect(0,0,n,this.height);this.contexts[i].fillStyle="#ffffff";
this.contexts[i].fillRect(0,0,t,this.height);12<this.zoomed_column?(n=parseInt(10*b,10),n=10<n?10:n,this.render_with_text(e,m,i,n)):this.render_with_rects(e,m,i);this.rendered[i]=1}}!this.scrollme&&l()&&(this.scrollme=new EasyScroller(c(this.dom_element)[0],{scrollingX:1,scrollingY:0,eventTarget:this.called_on}));1!==f&&l()&&this.scrollme.reflow()}}};this.render_x_axis_label=function(){c(this.dom_element).parent().before('<div class="logo_xaxis" class="centered" style="margin-left:40px"><p class="xaxis_text" style="width:10em;margin:1em auto">Model Position</p></div>')};
this.render_y_axis_label=function(){c(this.dom_element).parent().before('<canvas class="logo_yaxis" height="300" width="40"></canvas>');var a=c(this.called_on).find(".logo_yaxis");Math.abs(this.data.max_height);l()||(a[0]=G_vmlCanvasManager.initElement(a[0]));a=a[0].getContext("2d");a.beginPath();a.moveTo(40,1);a.lineTo(30,1);a.moveTo(40,256);a.lineTo(30,256);a.moveTo(40,128);a.lineTo(30,128);a.lineWidth=1;a.strokeStyle="#666666";a.stroke();a.fillStyle="#666666";a.textAlign="right";a.font="bold 10px Arial";
a.textBaseline="top";a.fillText(this.data.max_height.toFixed(1),28,0);a.textBaseline="middle";a.fillText(parseFloat(this.data.max_height/2).toFixed(1),28,128);a.fillText("0",28,256);a.save();a.translate(5,this.height/2);a.rotate(-Math.PI/2);a.textAlign="center";a.font="normal 12px Arial";a.fillText("Information Content",1,0);a.restore()};this.render_x_axis_label();this.render_y_axis_label();this.render_with_text=function(a,b,c,e){var j=0,i=a,g=0,g=Math.abs(this.data.max_height)+Math.abs(this.data.min_height_obs),
g=Math.round(100*Math.abs(this.data.max_height)/g);Math.round(256*g/100);b+3<=this.end&&(b+=3);for(g=a;g<=b;g++){if(this.data.mmline&&1===this.data.mmline[g-1])this.contexts[c].fillStyle="#cccccc",this.contexts[c].fillRect(j,10,this.zoomed_column,this.height-40);else if(a=this.data.height_arr[g-1])for(var q=0,m=a.length,n=0,n=0;n<m;n++){var r=a[n].split(":",2),t=j+this.zoomed_column/2,h=(0.0024*this.zoomed_column+0.0405).toFixed(2),p=null;if(0.01<r[1]){var p=parseFloat(r[1])/this.data.max_height,
u=254-q,x=258*p;l()||(u+=x*(p/2));this.contexts[c].font="bold 350px Arial";this.contexts[c].textAlign="center";this.contexts[c].fillStyle=this.colors[r[0]];this.contexts[c].transform(h,0,0,p,t,u);this.contexts[c].fillText(r[0],0,0);this.contexts[c].setTransform(1,0,0,1,0,0);q+=x}}k(this.contexts[c],j,this.height-15,5);k(this.contexts[c],j,this.height-30,5);k(this.contexts[c],j,this.height-45,5);0.7>this.zoom?0===g%5&&this.draw_column_divider({context_num:c,x:j,fontsize:10,column_num:i,ralign:!0}):
this.draw_column_divider({context_num:c,x:j,fontsize:e,column_num:i});a=this.data.delete_probs[g-1]/100;q=this.height-35;m="#ffffff";n="#555555";0.25<a?(m="#2171b5",n="#ffffff"):0.15<a?m="#6baed6":0.05<a&&(m="#bdd7e7");d(this.contexts[c],j,q,a,e,this.zoomed_column,m,n);a=this.contexts[c];q=j;m=this.height;n=this.zoomed_column;r=this.data.insert_probs[g-1]/100;t=m-20;h="#ffffff";p="#555555";0.1<r?(h="#d7301f",p="#ffffff"):0.05<r?h="#fc8d59":0.03<r&&(h="#fdcc8a");d(a,q,t,r,e,n,h,p);0.1<r&&k(a,q+n,m-
30,-30-m,h);a=this.data.insert_lengths[g-1];q="#ffffff";m="#555555";9<a?(q="#d7301f",m="#ffffff"):7<a?q="#fc8d59":4<a&&(q="#fdcc8a");d(this.contexts[c],j,this.height-5,a,e,this.zoomed_column,q,m);j+=this.zoomed_column;i++}f(this.contexts[c],this.height-15,this.total_width);f(this.contexts[c],this.height-30,this.total_width);f(this.contexts[c],this.height-45,this.total_width);f(this.contexts[c],0,this.total_width)};this.draw_column_divider=function(a){var b=a.ralign?a.x+this.zoomed_column:a.x,f=a.ralign?
a.x+2:a.x;k(this.contexts[a.context_num],b,this.height-30,-30-this.height,"#dddddd");k(this.contexts[a.context_num],b,0,5);var b=this.contexts[a.context_num],c=this.zoomed_column,d=a.column_num,i=a.ralign;b.font=a.fontsize+"px Arial";b.textAlign=i?"right":"center";b.fillStyle="#666666";b.fillText(d,f+c/2,10)};this.render_with_rects=function(a,b,c){var d=0,j=a,i=0,i=Math.abs(this.data.max_height),g=Math.abs(this.data.min_height_obs),i=Math.round(100*Math.abs(this.data.max_height)/(i+g));Math.round(256*
i/100);g=10;for(i=a;i<=b;i++){if(this.data.mmline&&1===this.data.mmline[i-1])this.contexts[c].fillStyle="#cccccc",this.contexts[c].fillRect(d,10,this.zoomed_column,this.height-40);else for(var a=this.data.height_arr[i-1],e=0,m=a.length,n=0,n=0;n<m;n++){var r=a[n].split(":",2);if(0.01<r[1]){var l=parseFloat(r[1])/this.data.max_height,h=d,l=256*l,p=256-e-l;this.contexts[c].fillStyle=this.colors[r[0]];this.contexts[c].fillRect(h,p,this.zoomed_column,l);e+=l}}0.2>this.zoom?g=20:0.3>this.zoom&&(g=10);
0===i%g&&(k(this.contexts[c],d+this.zoomed_column,this.height-30,parseFloat(this.height),"#dddddd"),k(this.contexts[c],d+this.zoomed_column,0,5),a=this.contexts[c],e=d-2,m=this.zoomed_column,n=j,a.font="10px Arial",a.textAlign="right",a.fillStyle="#666666",a.fillText(n,e+m/2,10));a=this.contexts[c];e=d;m=this.height-42;n=this.zoomed_column;r=this.data.insert_probs[i-1]/100;h=this.data.insert_lengths[i-1];l=this.data.delete_probs[i-1]/100;p="#ffffff";0.1<r?p="#d7301f":0.05<r?p="#fc8d59":0.03<r&&(p=
"#fdcc8a");a.fillStyle=p;a.fillRect(e,m+12,n,10);p="#ffffff";9<h?p="#d7301f":7<h?p="#fc8d59":4<h&&(p="#fdcc8a");a.fillStyle=p;a.fillRect(e,m+24,n,10);p="#ffffff";0.25<l?p="#2171b5":0.15<l?p="#6baed6":0.05<l&&(p="#bdd7e7");a.fillStyle=p;a.fillRect(e,m,n,10);f(this.contexts[c],this.height-45,this.total_width);f(this.contexts[c],0,this.total_width);d+=this.zoomed_column;j++}};this.toggle_scale=function(){var a=this.current_column();this.data.max_height=this.data.max_height===this.data.max_height_obs?
this.data.max_height_theory:this.data.max_height_obs;this.rendered=[];c(this.called_on).find(".logo_yaxis").remove();this.render_y_axis_label();this.scrollme.reflow();this.scrollToColumn(a+1);this.scrollToColumn(a)};this.current_column=function(){var a=this.scrollme.scroller.getValues().left,b=this.column_width*this.zoom,a=a/b,b=c(this.called_on).find(".logo_container").width()/b/2;return Math.ceil(a+b)};this.change_zoom=function(a){var b=0.3;a.target?b=a.target:a.distance&&(b=(parseFloat(this.zoom)-
parseFloat(a.distance)).toFixed(1),"+"===a.direction&&(b=(parseFloat(this.zoom)+parseFloat(a.distance)).toFixed(1)));1<b?b=1:0.1>b&&(b=0.1);c(this.called_on).find(".logo_graphic").width()*b/this.zoom>c(this.called_on).find(".logo_container").width()&&(a.column?(this.zoom=b,this.render({zoom:this.zoom}),this.scrollme.reflow(),b=this.coordinatesFromColumn(a.column),this.scrollme.scroller.scrollTo(b-a.offset)):(a=this.current_column(),this.zoom=b,this.render({zoom:this.zoom}),this.scrollme.reflow(),
this.scrollToColumn(a)));return this.zoom};this.columnFromCoordinates=function(a){return Math.ceil(a/(this.column_width*this.zoom))};this.coordinatesFromColumn=function(a){return(a-1)*this.column_width*this.zoom+this.column_width*this.zoom/2};this.scrollToColumn=function(a,b){var f=c(this.called_on).find(".logo_container").width()/2,d=this.coordinatesFromColumn(a);this.scrollme.scroller.scrollTo(d-f,0,b)}}var h=null;c.fn.hmm_logo=function(b){var f=null,k=c('<div class="logo_graphic">');if(l()){b=
b||{};c(this).append(c('<div class="logo_container">').append(k).append('<div class="logo_divider">'));b.data=c(this).data("logo");if(null===b.data)return;b.dom_element=k;b.called_on=this;var d=c('<form class="logo_form"><fieldset><label for="position">Column number</label><input type="text" name="position" class="logo_position"></input><button class="button logo_change">Go</button></fieldset></form>'),f=new e(b);f.render(b);f.scale_height_enabled&&f.data.max_height_obs<f.data.max_height_theory&&
d.append('<button class="logo_scale button">Toggle Scale</button><br/>');f.zoom_enabled&&d.append('<button class="logo_zoomout button">-</button><button class="logo_zoomin button">+</button>');c(this).append(d);c(this).find(".logo_reset").bind("click",function(a){a.preventDefault();a=f;a.change_zoom({target:a.default_zoom})});c(this).find(".logo_change").bind("click",function(a){a.preventDefault()});c(this).find(".logo_zoomin").bind("click",function(a){a.preventDefault();f.change_zoom({distance:0.1,
direction:"+"})});c(this).find(".logo_zoomout").bind("click",function(a){a.preventDefault();f.change_zoom({distance:0.1,direction:"-"})});c(this).find(".logo_scale").bind("click",function(a){a.preventDefault();f.toggle_scale()});c(this).find(".logo_position").bind("change",function(){var a=f;this.value.match(/^\d+$/m)&&a.scrollToColumn(this.value,1)});k.bind("dblclick",function(a){var b=f,d=c(this).offset(),d=parseInt(a.pageX-d.left,10),a=a.pageX-c(this).parent().offset().left,d=b.columnFromCoordinates(d);
1>b.zoom?b.change_zoom({target:1,offset:a,column:d}):b.change_zoom({target:0.3,offset:a,column:d})});b.column_info&&k.bind("click",function(a){var d=f,k=c('<table class="logo_col_info"></table>'),e="<tr>",j="",i=c(this).offset(),a=parseInt(a.pageX-i.left,10);c(this).parent().offset();var d=d.columnFromCoordinates(a),d=f.data.height_arr[d-1].slice(0).reverse(),i=Math.ceil(d.length/5),g=a=0,g="Probability";f.data.height_calc&&"score"===f.data.height_calc&&(g="Score");for(a=0;a<i;a++)e+="<th>Residue</th><th>"+
g+"</th>";k.append(c(e+"</tr>"));for(a=0;5>a;a++){j+="<tr>";for(g=a;d[g];)e=d[g].split(":",2),j+="<td>"+e[0]+"</td><td>"+e[1]+"</td>",g+=5;j+="</tr>"}k.append(c(j));c(b.column_info).empty().append(k)});c(document).bind(this.attr("id")+".scrolledTo",function(a,b){f.render({target:b})});c(document).keydown(function(a){a.ctrlKey||((61===a.which||107===a.which)&&f.change_zoom({distance:0.1,direction:"+"}),(109===a.which||0===a.which)&&f.change_zoom({distance:0.1,direction:"-"}))})}else c("#logo").replaceWith(c("#no_canvas").html());
return f}})(jQuery);/*

 Scroller
 http://github.com/zynga/scroller

 Copyright 2011, Zynga Inc.
 Licensed under the MIT License.
 https://raw.github.com/zynga/scroller/master/MIT-LICENSE.txt

 Based on the work of: Unify Project (unify-project.org)
 http://unify-project.org
 Copyright 2011, Deutsche Telekom AG
 License: MIT + Apache (V2)

 Inspired by: https://github.com/inexorabletash/raf-shim/blob/master/raf.js
*/
(function(c){if(!c.requestAnimationFrame){var l=Date.now||function(){return+new Date},e=Object.keys||function(a){var b={},f;for(f in a)b[f]=!0;return b},h=Object.empty||function(a){for(var b in a)return!1;return!0},b;a:{b=["webkit","moz","o","ms"];for(var f=0;4>f;f++)if(null!=c[b[f]+"RequestAnimationFrame"]){b=b[f];break a}b=void 0}if(b)c.requestAnimationFrame=c[b+"RequestAnimationFrame"],c.cancelRequestAnimationFrame=c[b+"CancelRequestAnimationFrame"];else{var k={},d=1,a=null;c.requestAnimationFrame=
function(b){var f=d++;k[f]=b;null===a&&(a=setTimeout(function(){var b=l(),f=k,c=e(f);k={};a=null;for(var d=0,h=c.length;d<h;d++)f[c[d]](b)},1E3/60));return f};c.cancelRequestAnimationFrame=function(b){delete k[b];h(k)&&(clearTimeout(a),a=null)}}}})(this);
(function(c){var l=Date.now||function(){return+new Date},e={},h=1;c.core?core.effect||(core.effect={}):c.core={effect:{}};core.effect.Animate={stop:function(b){var f=null!=e[b];f&&(e[b]=null);return f},isRunning:function(b){return null!=e[b]},start:function(b,f,c,d,a,y){var s=l(),w=s,j=0,i=0,g=h++;y||(y=document.body);if(0===g%20){var q={},m;for(m in e)q[m]=!0;e=q}var n=function(m){var m=!0!==m,h=l();if(!e[g]||f&&!f(g))e[g]=null,c&&c(60-i/((h-s)/1E3),g,!1);else{if(m)for(var q=Math.round((h-w)/(1E3/
60))-1,p=0;p<Math.min(q,4);p++)n(!0),i++;d&&(j=(h-s)/d,1<j&&(j=1));q=a?a(j):j;(!1===b(q,h,m)||1===j)&&m?(e[g]=null,c&&c(60-i/((h-s)/1E3),g,1===j||null==d)):m&&(w=h,requestAnimationFrame(n,y))}};e[g]=!0;requestAnimationFrame(n,y);return g}}})(this);
var EasyScroller=function(c,l){this.content=c;this.container=c.parentNode;this.options=l||{};var e=this;this.scroller=new Scroller(function(c,b,f){e.render(c,b,f)},l);this.bindEvents();this.content.style[EasyScroller.vendorPrefix+"TransformOrigin"]="left top";this.reflow()};
EasyScroller.prototype.render=function(){var c=document.documentElement.style,l;window.opera&&"[object Opera]"===Object.prototype.toString.call(opera)?l="presto":"MozAppearance"in c?l="gecko":"WebkitAppearance"in c?l="webkit":"string"===typeof navigator.cpuClass&&(l="trident");c=EasyScroller.vendorPrefix={trident:"ms",gecko:"Moz",webkit:"Webkit",presto:"O"}[l];l=document.createElement("div");var e=c+"Transform";return void 0!==l.style[c+"Perspective"]?function(c,b,f){this.content.style[e]="translate3d("+
-c+"px,"+-b+"px,0) scale("+f+")"}:void 0!==l.style[e]?function(c,b,f){this.content.style[e]="translate("+-c+"px,"+-b+"px) scale("+f+")"}:function(c,b,f){this.content.style.marginLeft=c?-c/f+"px":"";this.content.style.marginTop=b?-b/f+"px":"";this.content.style.zoom=f||""}}();
EasyScroller.prototype.reflow=function(){this.scroller.setDimensions(this.container.clientWidth,this.container.clientHeight,this.content.offsetWidth,this.content.offsetHeight);var c=this.container.getBoundingClientRect();this.scroller.setPosition(c.left+this.container.clientLeft,c.top+this.container.clientTop)};
EasyScroller.prototype.bindEvents=function(){var c=this;$(window).bind("resize",function(){c.reflow()});$("#modelTab").bind("click",function(){c.reflow()});if("ontouchstart"in window)this.container.addEventListener("touchstart",function(e){if(!e.touches[0]||!e.touches[0].target||!e.touches[0].target.tagName.match(/input|textarea|select/i))c.scroller.doTouchStart(e.touches,(new Date).getTime()),e.preventDefault()},!1),document.addEventListener("touchmove",function(e){c.scroller.doTouchMove(e.touches,
(new Date).getTime(),e.scale)},!1),document.addEventListener("touchend",function(){c.scroller.doTouchEnd((new Date).getTime())},!1),document.addEventListener("touchcancel",function(){c.scroller.doTouchEnd((new Date).getTime())},!1);else{var l=!1;$(this.container).bind("mousedown",function(e){e.target.tagName.match(/input|textarea|select/i)||(c.scroller.doTouchStart([{pageX:e.pageX,pageY:e.pageY}],(new Date).getTime()),l=!0,e.preventDefault())});$(document).bind("mousemove",function(e){l&&(c.scroller.doTouchMove([{pageX:e.pageX,
pageY:e.pageY}],(new Date).getTime()),l=!0)});$(document).bind("mouseup",function(){l&&(c.scroller.doTouchEnd((new Date).getTime()),l=!1)});$(this.container).bind("mousewheel",function(e){c.options.zooming&&(c.scroller.doMouseZoom(e.wheelDelta,(new Date).getTime(),e.pageX,e.pageY),e.preventDefault())})}};var Scroller;
(function(){Scroller=function(b,f){this.__callback=b;this.options={scrollingX:!0,scrollingY:!0,animating:!0,bouncing:!0,locking:!0,paging:!1,snapping:!1,zooming:!1,minZoom:0.5,maxZoom:3,eventTarget:null};for(var c in f)this.options[c]=f[c]};var c=function(b){return Math.pow(b-1,3)+1},l=function(b){return 1>(b/=0.5)?0.5*Math.pow(b,3):0.5*(Math.pow(b-2,3)+2)},e={__isSingleTouch:!1,__isTracking:!1,__isGesturing:!1,__isDragging:!1,__isDecelerating:!1,__isAnimating:!1,__clientLeft:0,__clientTop:0,__clientWidth:0,
__clientHeight:0,__contentWidth:0,__contentHeight:0,__snapWidth:100,__snapHeight:100,__refreshHeight:null,__refreshActive:!1,__refreshActivate:null,__refreshDeactivate:null,__refreshStart:null,__zoomLevel:1,__scrollLeft:0,__scrollTop:0,__maxScrollLeft:0,__maxScrollTop:0,__scheduledLeft:0,__scheduledTop:0,__scheduledZoom:0,__lastTouchLeft:null,__lastTouchTop:null,__lastTouchMove:null,__positions:null,__minDecelerationScrollLeft:null,__minDecelerationScrollTop:null,__maxDecelerationScrollLeft:null,
__maxDecelerationScrollTop:null,__decelerationVelocityX:null,__decelerationVelocityY:null,setDimensions:function(b,f,c,d){b&&(this.__clientWidth=b);f&&(this.__clientHeight=f);c&&(this.__contentWidth=c);d&&(this.__contentHeight=d);this.__computeScrollMax();this.scrollTo(this.__scrollLeft,this.__scrollTop,!0)},setPosition:function(b,f){this.__clientLeft=b||0;this.__clientTop=f||0},setSnapSize:function(b,f){this.__snapWidth=b;this.__snapHeight=f},activatePullToRefresh:function(b,f,c,d){this.__refreshHeight=
b;this.__refreshActivate=f;this.__refreshDeactivate=c;this.__refreshStart=d},finishPullToRefresh:function(){this.__refreshActive=!1;this.__refreshDeactivate&&this.__refreshDeactivate();this.scrollTo(this.__scrollLeft,this.__scrollTop,!0)},getValues:function(){return{left:this.__scrollLeft,top:this.__scrollTop,zoom:this.__zoomLevel}},getScrollMax:function(){return{left:this.__maxScrollLeft,top:this.__maxScrollTop}},zoomTo:function(b,f,c,d){if(!this.options.zooming)throw Error("Zooming is not enabled!");
this.__isDecelerating&&(core.effect.Animate.stop(this.__isDecelerating),this.__isDecelerating=!1);var a=this.__zoomLevel;null==c&&(c=this.__clientWidth/2);null==d&&(d=this.__clientHeight/2);b=Math.max(Math.min(b,this.options.maxZoom),this.options.minZoom);this.__computeScrollMax(b);c=(c+this.__scrollLeft)*b/a-c;d=(d+this.__scrollTop)*b/a-d;c>this.__maxScrollLeft?c=this.__maxScrollLeft:0>c&&(c=0);d>this.__maxScrollTop?d=this.__maxScrollTop:0>d&&(d=0);this.__publish(c,d,b,f)},zoomBy:function(b,c,k,
d){this.zoomTo(this.__zoomLevel*b,c,k,d)},scrollTo:function(b,c,k,d){$(document).trigger(this.options.eventTarget.attr("id")+".scrolledTo",[b,c,d]);this.__isDecelerating&&(core.effect.Animate.stop(this.__isDecelerating),this.__isDecelerating=!1);if(null!=d&&d!==this.__zoomLevel){if(!this.options.zooming)throw Error("Zooming is not enabled!");b*=d;c*=d;this.__computeScrollMax(d)}else d=this.__zoomLevel;this.options.scrollingX?this.options.paging?b=Math.round(b/this.__clientWidth)*this.__clientWidth:
this.options.snapping&&(b=Math.round(b/this.__snapWidth)*this.__snapWidth):b=this.__scrollLeft;this.options.scrollingY?this.options.paging?c=Math.round(c/this.__clientHeight)*this.__clientHeight:this.options.snapping&&(c=Math.round(c/this.__snapHeight)*this.__snapHeight):c=this.__scrollTop;b=Math.max(Math.min(this.__maxScrollLeft,b),0);c=Math.max(Math.min(this.__maxScrollTop,c),0);b===this.__scrollLeft&&c===this.__scrollTop&&(k=!1);this.__publish(b,c,d,k)},scrollBy:function(b,c,k){this.scrollTo((this.__isAnimating?
this.__scheduledLeft:this.__scrollLeft)+(b||0),(this.__isAnimating?this.__scheduledTop:this.__scrollTop)+(c||0),k)},doMouseZoom:function(b,c,k,d){return this.zoomTo(this.__zoomLevel*(0<b?0.97:1.03),!1,k-this.__clientLeft,d-this.__clientTop)},doTouchStart:function(b,c){if(null==b.length)throw Error("Invalid touch list: "+b);c instanceof Date&&(c=c.valueOf());if("number"!==typeof c)throw Error("Invalid timestamp value: "+c);this.__isDecelerating&&(core.effect.Animate.stop(this.__isDecelerating),this.__isDecelerating=
!1);this.__isAnimating&&(core.effect.Animate.stop(this.__isAnimating),this.__isAnimating=!1);var k,d,a=1===b.length;a?(k=b[0].pageX,d=b[0].pageY):(k=Math.abs(b[0].pageX+b[1].pageX)/2,d=Math.abs(b[0].pageY+b[1].pageY)/2);this.__initialTouchLeft=k;this.__initialTouchTop=d;this.__zoomLevelStart=this.__zoomLevel;this.__lastTouchLeft=k;this.__lastTouchTop=d;this.__lastTouchMove=c;this.__lastScale=1;this.__enableScrollX=!a&&this.options.scrollingX;this.__enableScrollY=!a&&this.options.scrollingY;this.__isTracking=
!0;this.__isDragging=!a;this.__isSingleTouch=a;this.__positions=[]},doTouchMove:function(b,c,k){if(null==b.length)throw Error("Invalid touch list: "+b);c instanceof Date&&(c=c.valueOf());if("number"!==typeof c)throw Error("Invalid timestamp value: "+c);if(this.__isTracking){var d;2===b.length?(d=Math.abs(b[0].pageX+b[1].pageX)/2,b=Math.abs(b[0].pageY+b[1].pageY)/2):(d=b[0].pageX,b=b[0].pageY);var a=this.__positions;if(this.__isDragging){var e=d-this.__lastTouchLeft,l=b-this.__lastTouchTop,h=this.__scrollLeft,
j=this.__scrollTop,i=this.__zoomLevel;if(null!=k&&this.options.zooming){var g=i,i=i/this.__lastScale*k,i=Math.max(Math.min(i,this.options.maxZoom),this.options.minZoom);if(g!==i){var q=d-this.__clientLeft,m=b-this.__clientTop,h=(q+h)*i/g-q,j=(m+j)*i/g-m;this.__computeScrollMax(i)}}if(this.__enableScrollX&&(h-=e,g=this.__maxScrollLeft,h>g||0>h))h=this.options.bouncing?h+e/2:h>g?g:0;if(this.__enableScrollY&&(j-=l,e=this.__maxScrollTop,j>e||0>j))this.options.bouncing?(j+=l/2,!this.__enableScrollX&&null!=
this.__refreshHeight&&(!this.__refreshActive&&j<=-this.__refreshHeight?(this.__refreshActive=!0,this.__refreshActivate&&this.__refreshActivate()):this.__refreshActive&&j>-this.__refreshHeight&&(this.__refreshActive=!1,this.__refreshDeactivate&&this.__refreshDeactivate()))):j=j>e?e:0;60<a.length&&a.splice(0,30);a.push(h,j,c);this.__publish(h,j,i)}else l=this.options.locking?3:0,h=Math.abs(d-this.__initialTouchLeft),j=Math.abs(b-this.__initialTouchTop),this.__enableScrollX=this.options.scrollingX&&
h>=l,this.__enableScrollY=this.options.scrollingY&&j>=l,a.push(this.__scrollLeft,this.__scrollTop,c),this.__isDragging=(this.__enableScrollX||this.__enableScrollY)&&(5<=h||5<=j);this.__lastTouchLeft=d;this.__lastTouchTop=b;this.__lastTouchMove=c;this.__lastScale=k}},doTouchEnd:function(b){b instanceof Date&&(b=b.valueOf());if("number"!==typeof b)throw Error("Invalid timestamp value: "+b);if(this.__isTracking){this.__isTracking=!1;if(this.__isDragging&&(this.__isDragging=!1,this.__isSingleTouch&&this.options.animating&&
100>=b-this.__lastTouchMove)){for(var c=this.__positions,e=c.length-1,d=e,a=e;0<a&&c[a]>this.__lastTouchMove-100;a-=3)d=a;if(d!==e&&(e=c[e]-c[d],a=this.__scrollTop-c[d-1],this.__decelerationVelocityX=(this.__scrollLeft-c[d-2])/e*(1E3/60),this.__decelerationVelocityY=a/e*(1E3/60),c=this.options.paging||this.options.snapping?4:1,Math.abs(this.__decelerationVelocityX)>c||Math.abs(this.__decelerationVelocityY)>c))this.__refreshActive||this.__startDeceleration(b)}this.__isDecelerating||(this.__refreshActive&&
this.__refreshStart?(this.__publish(this.__scrollLeft,-this.__refreshHeight,this.__zoomLevel,!0),this.__refreshStart&&this.__refreshStart()):(this.scrollTo(this.__scrollLeft,this.__scrollTop,!0,this.__zoomLevel),this.__refreshActive&&(this.__refreshActive=!1,this.__refreshDeactivate&&this.__refreshDeactivate())));this.__positions.length=0}},__publish:function(b,f,e,d){var a=this,h=a.__isAnimating;h&&(core.effect.Animate.stop(h),a.__isAnimating=!1);if(d&&a.options.animating){a.__scheduledLeft=b;a.__scheduledTop=
f;a.__scheduledZoom=e;var s=a.__scrollLeft,w=a.__scrollTop,j=a.__zoomLevel,i=b-s,g=f-w,q=e-j;a.__isAnimating=core.effect.Animate.start(function(b,c,d){d&&(a.__scrollLeft=s+i*b,a.__scrollTop=w+g*b,a.__zoomLevel=j+q*b,a.__callback&&a.__callback(a.__scrollLeft,a.__scrollTop,a.__zoomLevel))},function(b){return a.__isAnimating===b},function(b,c){c===a.__isAnimating&&(a.__isAnimating=!1);a.options.zooming&&a.__computeScrollMax()},250,h?c:l)}else a.__scheduledLeft=a.__scrollLeft=b,a.__scheduledTop=a.__scrollTop=
f,a.__scheduledZoom=a.__zoomLevel=e,a.__callback&&a.__callback(b,f,e),a.options.zooming&&a.__computeScrollMax()},__computeScrollMax:function(b){null==b&&(b=this.__zoomLevel);this.__maxScrollLeft=Math.max(this.__contentWidth*b-this.__clientWidth,0);this.__maxScrollTop=Math.max(this.__contentHeight*b-this.__clientHeight,0)},__startDeceleration:function(){var b=this;if(b.options.paging){var c=Math.max(Math.min(b.__scrollLeft,b.__maxScrollLeft),0),e=Math.max(Math.min(b.__scrollTop,b.__maxScrollTop),0),
d=b.__clientWidth,a=b.__clientHeight;b.__minDecelerationScrollLeft=Math.floor(c/d)*d;b.__minDecelerationScrollTop=Math.floor(e/a)*a;b.__maxDecelerationScrollLeft=Math.ceil(c/d)*d;b.__maxDecelerationScrollTop=Math.ceil(e/a)*a}else b.__minDecelerationScrollLeft=0,b.__minDecelerationScrollTop=0,b.__maxDecelerationScrollLeft=b.__maxScrollLeft,b.__maxDecelerationScrollTop=b.__maxScrollTop;var h=b.options.snapping?4:0.1;b.__isDecelerating=core.effect.Animate.start(function(a,c,d){b.__stepThroughDeceleration(d)},
function(){return Math.abs(b.__decelerationVelocityX)>=h||Math.abs(b.__decelerationVelocityY)>=h},function(){b.__isDecelerating=!1;b.scrollTo(b.__scrollLeft,b.__scrollTop,b.options.snapping)})},__stepThroughDeceleration:function(b){var c=this.__scrollLeft+this.__decelerationVelocityX,e=this.__scrollTop+this.__decelerationVelocityY;if(!this.options.bouncing){var d=Math.max(Math.min(this.__maxScrollLeft,c),0);d!==c&&(c=d,this.__decelerationVelocityX=0);d=Math.max(Math.min(this.__maxScrollTop,e),0);
d!==e&&(e=d,this.__decelerationVelocityY=0)}b?this.__publish(c,e,this.__zoomLevel):(this.__scrollLeft=c,this.__scrollTop=e);this.options.paging||(this.__decelerationVelocityX*=0.95,this.__decelerationVelocityY*=0.95);this.options.bouncing&&(d=b=0,c<this.__minDecelerationScrollLeft?b=this.__minDecelerationScrollLeft-c:c>this.__maxDecelerationScrollLeft&&(b=this.__maxDecelerationScrollLeft-c),e<this.__minDecelerationScrollTop?d=this.__minDecelerationScrollTop-e:e>this.__maxDecelerationScrollTop&&(d=
this.__maxDecelerationScrollTop-e),0!==b&&(this.__decelerationVelocityX=0>=b*this.__decelerationVelocityX?this.__decelerationVelocityX+0.03*b:0.08*b),0!==d&&(this.__decelerationVelocityY=0>=d*this.__decelerationVelocityY?this.__decelerationVelocityY+0.03*d:0.08*d))}},h;for(h in e)Scroller.prototype[h]=e[h]})();
