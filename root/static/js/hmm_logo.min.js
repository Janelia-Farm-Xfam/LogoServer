/*

 HMM logo
 http://github.com/url/here
 Copyright 2013, Jody Clements.
 Licensed under the MIT License.
 http://url/to/license
*/
(function(d){function k(){if(!b){var a=document.createElement("canvas");b=!(!a.getContext||!a.getContext("2d"))}return b}function g(a,b){b=b||{};this.value=a;this.width=parseInt(b.width,10)||100;"W"===this.value&&(this.width+=30*this.width/100);this.height=parseInt(b.height,10)||100;this.color=b.color||"#000000";this.fontSize=b.fontSize||138;this.scaled=function(){};this.draw=function(a,b,c,u,x){var d=a.font;a.transform(c/this.width,0,0,b/this.height,u,x);a.fillStyle=this.color;a.textAlign="center";
a.font="bold "+this.fontSize+"px Arial";a.fillText(this.value,0,0);a.setTransform(1,0,0,1,0,0);a.fillStyle="#000000";a.font=d}}function m(a){function b(c,a,u){c.beginPath();c.moveTo(0,a);c.lineTo(u,a);c.lineWidth=1;c.strokeStyle="#999999";c.stroke()}function f(c,a,b,u,f){f=f||"#999999";c.beginPath();c.moveTo(a,b);c.lineTo(a,b+u);c.lineWidth=1;c.strokeStyle=f;c.stroke()}function e(c,a,b,u,f,d,e,l){c.font=f+"px Arial";c.fillStyle=e;c.fillRect(a,b-10,d,14);c.textAlign="center";c.fillStyle=l;c.fillText(u,
a+d/2,b)}a=a||{};this.column_width=a.column_width||34;this.height=a.height||300;this.data=a.data||null;this.debug=a.debug||null;this.scale_height_enabled=a.height_toggle||null;this.zoom_enabled=a.zoom_buttons&&"disabled"===a.zoom_buttons?null:!0;this.alphabet=a.data.alphabet||"dna";this.dom_element=a.dom_element||d("body");this.called_on=a.called_on||null;this.start=a.start||1;this.end=a.end||this.data.height_arr.length;this.default_zoom=this.zoom=parseFloat(a.zoom)||0.4;this.data.max_height=a.scaled_max?
a.data.max_height_obs||this.data.max_height||2:a.data.max_height_theory||this.data.max_height||2;this.dna_colors={A:"#cbf751",C:"#5ec0cc",G:"#ffdf59",T:"#b51f16",U:"#b51f16"};this.aa_colors={A:"#FF9966",C:"#009999",D:"#FF0000",E:"#CC0033",F:"#00FF00",G:"#f2f20c",H:"#660033",I:"#CC9933",K:"#663300",L:"#FF9933",M:"#CC99CC",N:"#336666",P:"#0099FF",Q:"#6666CC",R:"#990000",S:"#0000FF",T:"#00FFFF",V:"#FFCC33",W:"#66CC66",Y:"#006600"};this.colors=this.dna_colors;"aa"===this.alphabet&&(this.colors=this.aa_colors);
this.canvas_width=5E3;this.letters={};a=null;for(a in this.colors)this.letters[a]=new g(a,{color:this.colors[a]});this.scrollme=null;this.previous_target=0;this.rendered=[];this.previous_zoom=0;this.render=function(c){if(this.data){c=c||{};var a=c.zoom||this.zoom,b=c.target||1,u=d(this.dom_element).parent().width(),f=1,e=0;if(b!==this.previous_target){this.previous_target=b;c.start&&(this.start=c.start);c.end&&(this.end=c.end);0.1>=a?a=0.1:1<=a&&(a=1);this.zoom=a;c=this.end||this.data.height_arr.length;
var h=this.start||1;c=c>this.data.height_arr.length?this.data.height_arr.length:c;c=c<h?h:c;h=h>c?c:h;h=1<h?h:1;this.y=this.height-20;this.max_width=this.column_width*(c-h+1);u>this.max_width&&(a=1,this.zoom_enabled=!1);this.zoom=a;this.zoomed_column=this.column_width*a;this.total_width=this.zoomed_column*(c-h+1);if(1>a)for(;this.total_width<u&&!(this.zoom+=0.1,this.zoomed_column=this.column_width*this.zoom,this.total_width=this.zoomed_column*(c-h+1),this.zoom_enabled=!1,1<=a););b>this.total_width&&
(b=this.total_width);d(this.dom_element).attr({width:this.total_width+"px"}).css({width:this.total_width+"px"});u=Math.ceil(this.total_width/this.canvas_width);this.columns_per_canvas=Math.ceil(this.canvas_width/this.zoomed_column);this.previous_zoom!==this.zoom&&(d(this.dom_element).find("canvas").remove(),this.previous_zoom=this.zoom,this.rendered=[]);this.canvases=[];this.contexts=[];for(e=0;e<u;e++){var l=this.columns_per_canvas*e+h,g=l+this.columns_per_canvas-1;g>c&&(g=c);var s=(g-l+1)*this.zoomed_column;
s>f&&(f=s);var n=f*e,w=n+s;if(b<w+w/2&&b>n-n/2&&1!==this.rendered[e]){var n=this.canvases,B=e,v=this.dom_element,t=this.height,m=s,C=e,D=f,y=d(v).find("#canv_"+C);y.length||(d(v).append('<canvas class="canvas_logo" id="canv_'+C+'"  height="'+t+'" width="'+m+'" style="left:'+D*C+'px"></canvas>'),y=d(v).find("#canv_"+C));d(y).attr("width",m).attr("height",t);k()||(y[0]=G_vmlCanvasManager.initElement(y[0]));n[B]=y[0];this.contexts[e]=this.canvases[e].getContext("2d");this.contexts[e].setTransform(1,
0,0,1,0,0);this.contexts[e].clearRect(0,0,s,this.height);this.contexts[e].fillStyle="#ffffff";this.contexts[e].fillRect(0,0,w,this.height);12<this.zoomed_column?(s=parseInt(10*a,10),s=10<s?10:s,this.debug&&this.render_with_rects(l,g,e,1),this.render_with_text(l,g,e,s)):this.render_with_rects(l,g,e);this.rendered[e]=1}}!this.scrollme&&k()&&(this.scrollme=new EasyScroller(d(this.dom_element)[0],{scrollingX:1,scrollingY:0,eventTarget:this.called_on}));1!==b&&k()&&this.scrollme.reflow()}}};this.render_x_axis_label=
function(){d(this.dom_element).parent().before('<div class="logo_xaxis" class="centered" style="margin-left:40px"><p class="xaxis_text" style="width:10em;margin:1em auto">Model Position</p></div>')};this.render_y_axis_label=function(){d(this.dom_element).parent().before('<canvas class="logo_yaxis" height="300" width="55"></canvas>');var c=d(this.called_on).find(".logo_yaxis");Math.abs(this.data.max_height);isNaN(this.data.min_height_obs)||parseInt(this.data.min_height_obs,10);k()||(c[0]=G_vmlCanvasManager.initElement(c[0]));
c=c[0].getContext("2d");c.beginPath();c.moveTo(55,1);c.lineTo(40,1);c.moveTo(55,256);c.lineTo(40,256);c.moveTo(55,128);c.lineTo(40,128);c.lineWidth=1;c.strokeStyle="#666666";c.stroke();c.fillStyle="#666666";c.textAlign="right";c.font="bold 10px Arial";c.textBaseline="top";c.fillText(this.data.max_height.toFixed(1),38,0);c.textBaseline="middle";c.fillText(parseFloat(this.data.max_height/2).toFixed(1),38,128);c.fillText("0",38,256);c.save();c.translate(5,this.height/2-20);c.rotate(-Math.PI/2);c.textAlign=
"center";c.font="normal 12px Arial";c.fillText("Information Content (bits)",1,0);c.restore();c.fillText("occupancy",55,263);c.fillText("ins. prob.",50,280);c.fillText("ins. len.",46,296)};this.render_x_axis_label();this.render_y_axis_label();this.render_with_text=function(c,a,d,q){var g=0,p=c,h=0,h=Math.abs(this.data.max_height),l=isNaN(this.data.min_height_obs)?0:parseInt(this.data.min_height_obs,10),h=h+Math.abs(l),h=Math.round(100*Math.abs(this.data.max_height)/h);Math.round(256*h/100);a+3<=this.end&&
(a+=3);for(h=c;h<=a;h++){if(this.data.mmline&&1===this.data.mmline[h-1])this.contexts[d].fillStyle="#cccccc",this.contexts[d].fillRect(g,10,this.zoomed_column,this.height-40);else if(c=this.data.height_arr[h-1],l=[],c){for(var r=0,s=c.length,n=0,n=0;n<s;n++){var w=c[n].split(":",2),m=g+this.zoomed_column/2,v=null;if(0.01<w[1]){var v=parseFloat(w[1])/this.data.max_height,w=255-r,t=255*v;k()||(w+=t*(v/2));l[n]=[t,this.zoomed_column,m,w];r+=t}}for(n=s;0<=n;n--)l[n]&&this.letters[c[n][0]]&&this.letters[c[n][0]].draw(this.contexts[d],
l[n][0],l[n][1],l[n][2],l[n][3])}f(this.contexts[d],g,this.height-15,5);f(this.contexts[d],g,this.height-30,5);f(this.contexts[d],g,this.height-45,5);0.7>this.zoom?0===h%5&&this.draw_column_divider({context_num:d,x:g,fontsize:10,column_num:p,ralign:!0}):this.draw_column_divider({context_num:d,x:g,fontsize:q,column_num:p});c=this.data.delete_probs[h-1]/100;l=this.height-35;r="#ffffff";s="#555555";0.25<c?(r="#2171b5",s="#ffffff"):0.15<c?r="#6baed6":0.05<c&&(r="#bdd7e7");e(this.contexts[d],g,l,c,q,this.zoomed_column,
r,s);c=this.contexts[d];l=g;r=this.height;s=this.zoomed_column;n=this.data.insert_probs[h-1]/100;m=r-20;v="#ffffff";w="#555555";0.1<n?(v="#d7301f",w="#ffffff"):0.05<n?v="#fc8d59":0.03<n&&(v="#fdcc8a");e(c,l,m,n,q,s,v,w);0.03<n&&f(c,l+s,r-30,-30-r,v);c=this.data.insert_lengths[h-1];l="#ffffff";r="#555555";9<c?(l="#d7301f",r="#ffffff"):7<c?l="#fc8d59":4<c&&(l="#fdcc8a");e(this.contexts[d],g,this.height-5,c,q,this.zoomed_column,l,r);g+=this.zoomed_column;p++}b(this.contexts[d],this.height-15,this.total_width);
b(this.contexts[d],this.height-30,this.total_width);b(this.contexts[d],this.height-45,this.total_width);b(this.contexts[d],0,this.total_width)};this.draw_column_divider=function(c){var a=c.ralign?c.x+this.zoomed_column:c.x,b=c.ralign?c.x+2:c.x;f(this.contexts[c.context_num],a,this.height-30,-30-this.height,"#dddddd");f(this.contexts[c.context_num],a,0,5);var a=this.contexts[c.context_num],u=this.zoomed_column,e=c.column_num,d=c.ralign;a.font=c.fontsize+"px Arial";a.textAlign=d?"right":"center";a.fillStyle=
"#666666";a.fillText(e,b+u/2,10)};this.render_with_rects=function(c,a,e,d){var g=0,p=c,h=0,h=Math.abs(this.data.max_height),l=Math.abs(this.data.min_height_obs),h=h+l,h=Math.round(100*Math.abs(this.data.max_height)/h);Math.round(256*h/100);l=10;for(h=c;h<=a;h++){if(this.data.mmline&&1===this.data.mmline[h-1])this.contexts[e].fillStyle="#cccccc",this.contexts[e].fillRect(g,10,this.zoomed_column,this.height-40);else{c=this.data.height_arr[h-1];for(var r=0,s=c.length,n=0,n=0;n<s;n++){var k=c[n].split(":",
2);if(0.01<k[1]){var m=parseFloat(k[1])/this.data.max_height,v=g,m=256*m,t=256-r-m;d?(this.contexts[e].strokeStyle=this.colors[k[0]],this.contexts[e].strokeRect(v,t,this.zoomed_column,m)):(this.contexts[e].fillStyle=this.colors[k[0]],this.contexts[e].fillRect(v,t,this.zoomed_column,m));r+=m}}}0.2>this.zoom?l=20:0.3>this.zoom&&(l=10);0===h%l&&(f(this.contexts[e],g+this.zoomed_column,this.height-30,parseFloat(this.height),"#dddddd"),f(this.contexts[e],g+this.zoomed_column,0,5),c=this.contexts[e],r=
g-2,s=this.zoomed_column,n=p,c.font="10px Arial",c.textAlign="right",c.fillStyle="#666666",c.fillText(n,r+s/2,10));c=this.contexts[e];r=g;s=this.height-42;n=this.zoomed_column;k=this.data.insert_probs[h-1]/100;v=this.data.insert_lengths[h-1];m=this.data.delete_probs[h-1]/100;t="#ffffff";0.1<k?t="#d7301f":0.05<k?t="#fc8d59":0.03<k&&(t="#fdcc8a");c.fillStyle=t;c.fillRect(r,s+12,n,10);t="#ffffff";9<v?t="#d7301f":7<v?t="#fc8d59":4<v&&(t="#fdcc8a");c.fillStyle=t;c.fillRect(r,s+24,n,10);t="#ffffff";0.25<
m?t="#2171b5":0.15<m?t="#6baed6":0.05<m&&(t="#bdd7e7");c.fillStyle=t;c.fillRect(r,s,n,10);b(this.contexts[e],this.height-45,this.total_width);b(this.contexts[e],0,this.total_width);g+=this.zoomed_column;p++}};this.toggle_scale=function(){var c=this.current_column();this.data.max_height=this.data.max_height===this.data.max_height_obs?this.data.max_height_theory:this.data.max_height_obs;this.rendered=[];d(this.called_on).find(".logo_yaxis").remove();this.render_y_axis_label();this.scrollme.reflow();
this.scrollToColumn(c+1);this.scrollToColumn(c)};this.current_column=function(){var c=this.scrollme.scroller.getValues().left,a=this.column_width*this.zoom,c=c/a,a=d(this.called_on).find(".logo_container").width()/a/2;return Math.ceil(c+a)};this.change_zoom=function(c){var a=0.3;c.target?a=c.target:c.distance&&(a=(parseFloat(this.zoom)-parseFloat(c.distance)).toFixed(1),"+"===c.direction&&(a=(parseFloat(this.zoom)+parseFloat(c.distance)).toFixed(1)));1<a?a=1:0.1>a&&(a=0.1);d(this.called_on).find(".logo_graphic").width()*
a/this.zoom>d(this.called_on).find(".logo_container").width()&&(c.column?(this.zoom=a,this.render({zoom:this.zoom}),this.scrollme.reflow(),a=this.coordinatesFromColumn(c.column),this.scrollme.scroller.scrollTo(a-c.offset)):(c=this.current_column(),this.zoom=a,this.render({zoom:this.zoom}),this.scrollme.reflow(),this.scrollToColumn(c)));return this.zoom};this.columnFromCoordinates=function(a){return Math.ceil(a/(this.column_width*this.zoom))};this.coordinatesFromColumn=function(a){return(a-1)*this.column_width*
this.zoom+this.column_width*this.zoom/2};this.scrollToColumn=function(a,b){var e=d(this.called_on).find(".logo_container").width()/2,u=this.coordinatesFromColumn(a);this.scrollme.scroller.scrollTo(u-e,0,b)}}var b=null;d.fn.hmm_logo=function(a){var b=null,f=d('<div class="logo_graphic">');if(k()){a=a||{};d(this).append(d('<div class="logo_container">').append(f).append('<div class="logo_divider">'));a.data=d(this).data("logo");if(null===a.data)return;a.dom_element=f;a.called_on=this;var e=d('<form class="logo_form"><fieldset><label for="position">Column number</label><input type="text" name="position" class="logo_position"></input><button class="button logo_change">Go</button></fieldset></form>'),
b=new m(a);b.render(a);b.scale_height_enabled&&b.data.max_height_obs<b.data.max_height_theory&&e.append('<button class="logo_scale button">Toggle Scale</button><br/>');b.zoom_enabled&&e.append('<button class="logo_zoomout button">-</button><button class="logo_zoomin button">+</button>');d(this).append(e);d(this).find(".logo_reset").bind("click",function(a){a.preventDefault();a=b;a.change_zoom({target:a.default_zoom})});d(this).find(".logo_change").bind("click",function(a){a.preventDefault()});d(this).find(".logo_zoomin").bind("click",
function(a){a.preventDefault();b.change_zoom({distance:0.1,direction:"+"})});d(this).find(".logo_zoomout").bind("click",function(a){a.preventDefault();b.change_zoom({distance:0.1,direction:"-"})});d(this).find(".logo_scale").bind("click",function(a){a.preventDefault();b.toggle_scale()});d(this).find(".logo_position").bind("change",function(){var a=b;this.value.match(/^\d+$/m)&&a.scrollToColumn(this.value,1)});f.bind("dblclick",function(a){var e=b,f=d(this).offset(),f=parseInt(a.pageX-f.left,10);a=
a.pageX-d(this).parent().offset().left;f=e.columnFromCoordinates(f);1>e.zoom?e.change_zoom({target:1,offset:a,column:f}):e.change_zoom({target:0.3,offset:a,column:f})});a.column_info&&f.bind("click",function(c){var e=b,f=d('<table class="logo_col_info"></table>'),g="<tr>",k="",p=d(this).offset();c=parseInt(c.pageX-p.left,10);d(this).parent().offset();e=e.columnFromCoordinates(c);c=[];var h=p=0,l=0,l="Probability";b.data.height_calc&&"score"===b.data.height_calc?(l="Score",c=b.data.height_arr[e-1].slice(0).reverse()):
c=b.data.probs_arr[e-1].slice(0).reverse();p=Math.ceil(c.length/5);for(h=0;h<p;h++)g=1<p&&h<p-1?g+('<th>Residue</th><th class="odd">'+l+"</th>"):g+("<th>Residue</th><th>"+l+"</th>");f.append(d(g+"</tr>"));for(h=0;5>h;h++){k+="<tr>";for(l=h;c[l];)g=c[l].split(":",2),k=1<p&&15>l?k+('<td class="'+b.alphabet+"_"+g[0]+'"><div></div>'+g[0]+'</td><td class="odd">'+g[1]+"</td>"):k+('<td class="'+b.alphabet+"_"+g[0]+'"><div></div>'+g[0]+"</td><td>"+g[1]+"</td>"),l+=5;k+="</tr>"}f.append(d(k));d(a.column_info).empty().append(d("<p> Column:"+
e+"</p>")).append(f).show()});d(document).bind(this.attr("id")+".scrolledTo",function(a,e,f,d){b.render({target:e})});d(document).keydown(function(a){a.ctrlKey||(61!==a.which&&107!==a.which||b.change_zoom({distance:0.1,direction:"+"}),109!==a.which&&0!==a.which||b.change_zoom({distance:0.1,direction:"-"}))})}else d("#logo").replaceWith(d("#no_canvas").html());return b}})(jQuery);/*

 Scroller
 http://github.com/zynga/scroller

 Copyright 2011, Zynga Inc.
 Licensed under the MIT License.
 https://raw.github.com/zynga/scroller/master/MIT-LICENSE.txt

 Based on the work of: Unify Project (unify-project.org)
 http://unify-project.org
 Copyright 2011, Deutsche Telekom AG
 License: MIT + Apache (V2)

 Inspired by: https://github.com/inexorabletash/raf-shim/blob/master/raf.js
*/
(function(d){if(!d.requestAnimationFrame){var k=Date.now||function(){return+new Date},g=Object.keys||function(a){var c={},b;for(b in a)c[b]=!0;return c},m=Object.empty||function(a){for(var c in a)return!1;return!0},b=function(){for(var a=["webkit","moz","o","ms"],c=0;4>c;c++)if(null!=d[a[c]+"RequestAnimationFrame"])return a[c]}();if(b)d.requestAnimationFrame=d[b+"RequestAnimationFrame"],d.cancelRequestAnimationFrame=d[b+"CancelRequestAnimationFrame"];else{var a={},u=1,f=null;d.requestAnimationFrame=
function(b,c){var d=u++;a[d]=b;null===f&&(f=setTimeout(function(){var c=k(),b=a,e=g(b);a={};f=null;for(var d=0,u=e.length;d<u;d++)b[e[d]](c)},1E3/60));return d};d.cancelRequestAnimationFrame=function(b){delete a[b];m(a)&&(clearTimeout(f),f=null)}}}})(this);
(function(d){var k=Date.now||function(){return+new Date},g={},m=1;d.core?core.effect||(core.effect={}):d.core={effect:{}};core.effect.Animate={stop:function(b){var a=null!=g[b];a&&(g[b]=null);return a},isRunning:function(b){return null!=g[b]},start:function(b,a,d,f,e,c){var A=k(),x=A,q=0,z=0,p=m++;c||(c=document.body);if(0===p%20){var h={},l;for(l in g)h[l]=!0;g=h}var r=function(h){h=!0!==h;var l=k();if(!g[p]||a&&!a(p))g[p]=null,d&&d(60-z/((l-A)/1E3),p,!1);else{if(h)for(var m=Math.round((l-x)/(1E3/
60))-1,B=0;B<Math.min(m,4);B++)r(!0),z++;f&&(q=(l-A)/f,1<q&&(q=1));m=e?e(q):q;!1!==b(m,l,h)&&1!==q||!h?h&&(x=l,requestAnimationFrame(r,c)):(g[p]=null,d&&d(60-z/((l-A)/1E3),p,1===q||null==f))}};g[p]=!0;requestAnimationFrame(r,c);return p}}})(this);
var EasyScroller=function(d,k){this.content=d;this.container=d.parentNode;this.options=k||{};var g=this;this.scroller=new Scroller(function(d,b,a){g.render(d,b,a)},k);this.bindEvents();this.content.style[EasyScroller.vendorPrefix+"TransformOrigin"]="left top";this.reflow()};
EasyScroller.prototype.render=function(){var d=document.documentElement.style,k;window.opera&&"[object Opera]"===Object.prototype.toString.call(opera)?k="presto":"MozAppearance"in d?k="gecko":"WebkitAppearance"in d?k="webkit":"string"===typeof navigator.cpuClass&&(k="trident");d=EasyScroller.vendorPrefix={trident:"ms",gecko:"Moz",webkit:"Webkit",presto:"O"}[k];k=document.createElement("div");var g=d+"Transform";return void 0!==k.style[d+"Perspective"]?function(d,b,a){this.content.style[g]="translate3d("+
-d+"px,"+-b+"px,0) scale("+a+")"}:void 0!==k.style[g]?function(d,b,a){this.content.style[g]="translate("+-d+"px,"+-b+"px) scale("+a+")"}:function(d,b,a){this.content.style.marginLeft=d?-d/a+"px":"";this.content.style.marginTop=b?-b/a+"px":"";this.content.style.zoom=a||""}}();
EasyScroller.prototype.reflow=function(){this.scroller.setDimensions(this.container.clientWidth,this.container.clientHeight,this.content.offsetWidth,this.content.offsetHeight);var d=this.container.getBoundingClientRect();this.scroller.setPosition(d.left+this.container.clientLeft,d.top+this.container.clientTop)};
EasyScroller.prototype.bindEvents=function(){var d=this;$(window).bind("resize",function(){d.reflow()});$("#modelTab").bind("click",function(){d.reflow()});if("ontouchstart"in window)this.container.addEventListener("touchstart",function(g){g.touches[0]&&g.touches[0].target&&g.touches[0].target.tagName.match(/input|textarea|select/i)||(d.scroller.doTouchStart(g.touches,(new Date).getTime()),g.preventDefault())},!1),document.addEventListener("touchmove",function(g){d.scroller.doTouchMove(g.touches,
(new Date).getTime(),g.scale)},!1),document.addEventListener("touchend",function(g){d.scroller.doTouchEnd((new Date).getTime())},!1),document.addEventListener("touchcancel",function(g){d.scroller.doTouchEnd((new Date).getTime())},!1);else{var k=!1;$(this.container).bind("mousedown",function(g){g.target.tagName.match(/input|textarea|select/i)||(d.scroller.doTouchStart([{pageX:g.pageX,pageY:g.pageY}],(new Date).getTime()),k=!0,g.preventDefault())});$(document).bind("mousemove",function(g){k&&(d.scroller.doTouchMove([{pageX:g.pageX,
pageY:g.pageY}],(new Date).getTime()),k=!0)});$(document).bind("mouseup",function(g){k&&(d.scroller.doTouchEnd((new Date).getTime()),k=!1)});$(this.container).bind("mousewheel",function(g){d.options.zooming&&(d.scroller.doMouseZoom(g.wheelDelta,(new Date).getTime(),g.pageX,g.pageY),g.preventDefault())})}};var Scroller;
(function(){Scroller=function(b,a){this.__callback=b;this.options={scrollingX:!0,scrollingY:!0,animating:!0,bouncing:!0,locking:!0,paging:!1,snapping:!1,zooming:!1,minZoom:0.5,maxZoom:3,eventTarget:null};for(var d in a)this.options[d]=a[d]};var d=function(b){return Math.pow(b-1,3)+1},k=function(b){return 1>(b/=0.5)?0.5*Math.pow(b,3):0.5*(Math.pow(b-2,3)+2)},g={__isSingleTouch:!1,__isTracking:!1,__isGesturing:!1,__isDragging:!1,__isDecelerating:!1,__isAnimating:!1,__clientLeft:0,__clientTop:0,__clientWidth:0,
__clientHeight:0,__contentWidth:0,__contentHeight:0,__snapWidth:100,__snapHeight:100,__refreshHeight:null,__refreshActive:!1,__refreshActivate:null,__refreshDeactivate:null,__refreshStart:null,__zoomLevel:1,__scrollLeft:0,__scrollTop:0,__maxScrollLeft:0,__maxScrollTop:0,__scheduledLeft:0,__scheduledTop:0,__scheduledZoom:0,__lastTouchLeft:null,__lastTouchTop:null,__lastTouchMove:null,__positions:null,__minDecelerationScrollLeft:null,__minDecelerationScrollTop:null,__maxDecelerationScrollLeft:null,
__maxDecelerationScrollTop:null,__decelerationVelocityX:null,__decelerationVelocityY:null,setDimensions:function(b,a,d,f){b&&(this.__clientWidth=b);a&&(this.__clientHeight=a);d&&(this.__contentWidth=d);f&&(this.__contentHeight=f);this.__computeScrollMax();this.scrollTo(this.__scrollLeft,this.__scrollTop,!0)},setPosition:function(b,a){this.__clientLeft=b||0;this.__clientTop=a||0},setSnapSize:function(b,a){this.__snapWidth=b;this.__snapHeight=a},activatePullToRefresh:function(b,a,d,f){this.__refreshHeight=
b;this.__refreshActivate=a;this.__refreshDeactivate=d;this.__refreshStart=f},finishPullToRefresh:function(){this.__refreshActive=!1;this.__refreshDeactivate&&this.__refreshDeactivate();this.scrollTo(this.__scrollLeft,this.__scrollTop,!0)},getValues:function(){return{left:this.__scrollLeft,top:this.__scrollTop,zoom:this.__zoomLevel}},getScrollMax:function(){return{left:this.__maxScrollLeft,top:this.__maxScrollTop}},zoomTo:function(b,a,d,f){if(!this.options.zooming)throw Error("Zooming is not enabled!");
this.__isDecelerating&&(core.effect.Animate.stop(this.__isDecelerating),this.__isDecelerating=!1);var e=this.__zoomLevel;null==d&&(d=this.__clientWidth/2);null==f&&(f=this.__clientHeight/2);b=Math.max(Math.min(b,this.options.maxZoom),this.options.minZoom);this.__computeScrollMax(b);d=(d+this.__scrollLeft)*b/e-d;f=(f+this.__scrollTop)*b/e-f;d>this.__maxScrollLeft?d=this.__maxScrollLeft:0>d&&(d=0);f>this.__maxScrollTop?f=this.__maxScrollTop:0>f&&(f=0);this.__publish(d,f,b,a)},zoomBy:function(b,a,d,
f){this.zoomTo(this.__zoomLevel*b,a,d,f)},scrollTo:function(b,a,d,f){$(document).trigger(this.options.eventTarget.attr("id")+".scrolledTo",[b,a,f]);this.__isDecelerating&&(core.effect.Animate.stop(this.__isDecelerating),this.__isDecelerating=!1);if(null!=f&&f!==this.__zoomLevel){if(!this.options.zooming)throw Error("Zooming is not enabled!");b*=f;a*=f;this.__computeScrollMax(f)}else f=this.__zoomLevel;this.options.scrollingX?this.options.paging?b=Math.round(b/this.__clientWidth)*this.__clientWidth:
this.options.snapping&&(b=Math.round(b/this.__snapWidth)*this.__snapWidth):b=this.__scrollLeft;this.options.scrollingY?this.options.paging?a=Math.round(a/this.__clientHeight)*this.__clientHeight:this.options.snapping&&(a=Math.round(a/this.__snapHeight)*this.__snapHeight):a=this.__scrollTop;b=Math.max(Math.min(this.__maxScrollLeft,b),0);a=Math.max(Math.min(this.__maxScrollTop,a),0);b===this.__scrollLeft&&a===this.__scrollTop&&(d=!1);this.__publish(b,a,f,d)},scrollBy:function(b,a,d){this.scrollTo((this.__isAnimating?
this.__scheduledLeft:this.__scrollLeft)+(b||0),(this.__isAnimating?this.__scheduledTop:this.__scrollTop)+(a||0),d)},doMouseZoom:function(b,a,d,f){return this.zoomTo(this.__zoomLevel*(0<b?0.97:1.03),!1,d-this.__clientLeft,f-this.__clientTop)},doTouchStart:function(b,a){if(null==b.length)throw Error("Invalid touch list: "+b);a instanceof Date&&(a=a.valueOf());if("number"!==typeof a)throw Error("Invalid timestamp value: "+a);this.__isDecelerating&&(core.effect.Animate.stop(this.__isDecelerating),this.__isDecelerating=
!1);this.__isAnimating&&(core.effect.Animate.stop(this.__isAnimating),this.__isAnimating=!1);var d,f,e=1===b.length;e?(d=b[0].pageX,f=b[0].pageY):(d=Math.abs(b[0].pageX+b[1].pageX)/2,f=Math.abs(b[0].pageY+b[1].pageY)/2);this.__initialTouchLeft=d;this.__initialTouchTop=f;this.__zoomLevelStart=this.__zoomLevel;this.__lastTouchLeft=d;this.__lastTouchTop=f;this.__lastTouchMove=a;this.__lastScale=1;this.__enableScrollX=!e&&this.options.scrollingX;this.__enableScrollY=!e&&this.options.scrollingY;this.__isTracking=
!0;this.__isDragging=!e;this.__isSingleTouch=e;this.__positions=[]},doTouchMove:function(b,a,d){if(null==b.length)throw Error("Invalid touch list: "+b);a instanceof Date&&(a=a.valueOf());if("number"!==typeof a)throw Error("Invalid timestamp value: "+a);if(this.__isTracking){var f;2===b.length?(f=Math.abs(b[0].pageX+b[1].pageX)/2,b=Math.abs(b[0].pageY+b[1].pageY)/2):(f=b[0].pageX,b=b[0].pageY);var e=this.__positions;if(this.__isDragging){var c=f-this.__lastTouchLeft,g=b-this.__lastTouchTop,k=this.__scrollLeft,
q=this.__scrollTop,m=this.__zoomLevel;if(null!=d&&this.options.zooming){var p=m,m=m/this.__lastScale*d,m=Math.max(Math.min(m,this.options.maxZoom),this.options.minZoom);if(p!==m){var h=f-this.__clientLeft,l=b-this.__clientTop,k=(h+k)*m/p-h,q=(l+q)*m/p-l;this.__computeScrollMax(m)}}this.__enableScrollX&&(k-=c,p=this.__maxScrollLeft,k>p||0>k)&&(k=this.options.bouncing?k+c/2:k>p?p:0);this.__enableScrollY&&(q-=g,c=this.__maxScrollTop,q>c||0>q)&&(this.options.bouncing?(q+=g/2,this.__enableScrollX||null==
this.__refreshHeight||(!this.__refreshActive&&q<=-this.__refreshHeight?(this.__refreshActive=!0,this.__refreshActivate&&this.__refreshActivate()):this.__refreshActive&&q>-this.__refreshHeight&&(this.__refreshActive=!1,this.__refreshDeactivate&&this.__refreshDeactivate()))):q=q>c?c:0);60<e.length&&e.splice(0,30);e.push(k,q,a);this.__publish(k,q,m)}else g=this.options.locking?3:0,k=Math.abs(f-this.__initialTouchLeft),q=Math.abs(b-this.__initialTouchTop),this.__enableScrollX=this.options.scrollingX&&
k>=g,this.__enableScrollY=this.options.scrollingY&&q>=g,e.push(this.__scrollLeft,this.__scrollTop,a),this.__isDragging=(this.__enableScrollX||this.__enableScrollY)&&(5<=k||5<=q);this.__lastTouchLeft=f;this.__lastTouchTop=b;this.__lastTouchMove=a;this.__lastScale=d}},doTouchEnd:function(b){b instanceof Date&&(b=b.valueOf());if("number"!==typeof b)throw Error("Invalid timestamp value: "+b);if(this.__isTracking){this.__isTracking=!1;if(this.__isDragging&&(this.__isDragging=!1,this.__isSingleTouch&&this.options.animating&&
100>=b-this.__lastTouchMove)){for(var a=this.__positions,d=a.length-1,f=d,e=d;0<e&&a[e]>this.__lastTouchMove-100;e-=3)f=e;f!==d&&(d=a[d]-a[f],e=this.__scrollTop-a[f-1],this.__decelerationVelocityX=(this.__scrollLeft-a[f-2])/d*(1E3/60),this.__decelerationVelocityY=e/d*(1E3/60),a=this.options.paging||this.options.snapping?4:1,Math.abs(this.__decelerationVelocityX)>a||Math.abs(this.__decelerationVelocityY)>a)&&(this.__refreshActive||this.__startDeceleration(b))}this.__isDecelerating||(this.__refreshActive&&
this.__refreshStart?(this.__publish(this.__scrollLeft,-this.__refreshHeight,this.__zoomLevel,!0),this.__refreshStart&&this.__refreshStart()):(this.scrollTo(this.__scrollLeft,this.__scrollTop,!0,this.__zoomLevel),this.__refreshActive&&(this.__refreshActive=!1,this.__refreshDeactivate&&this.__refreshDeactivate())));this.__positions.length=0}},__publish:function(b,a,g,f){var e=this,c=e.__isAnimating;c&&(core.effect.Animate.stop(c),e.__isAnimating=!1);if(f&&e.options.animating){e.__scheduledLeft=b;e.__scheduledTop=
a;e.__scheduledZoom=g;var m=e.__scrollLeft,x=e.__scrollTop,q=e.__zoomLevel,z=b-m,p=a-x,h=g-q;e.__isAnimating=core.effect.Animate.start(function(a,b,c){c&&(e.__scrollLeft=m+z*a,e.__scrollTop=x+p*a,e.__zoomLevel=q+h*a,e.__callback&&e.__callback(e.__scrollLeft,e.__scrollTop,e.__zoomLevel))},function(a){return e.__isAnimating===a},function(a,b,c){b===e.__isAnimating&&(e.__isAnimating=!1);e.options.zooming&&e.__computeScrollMax()},250,c?d:k)}else e.__scheduledLeft=e.__scrollLeft=b,e.__scheduledTop=e.__scrollTop=
a,e.__scheduledZoom=e.__zoomLevel=g,e.__callback&&e.__callback(b,a,g),e.options.zooming&&e.__computeScrollMax()},__computeScrollMax:function(b){null==b&&(b=this.__zoomLevel);this.__maxScrollLeft=Math.max(this.__contentWidth*b-this.__clientWidth,0);this.__maxScrollTop=Math.max(this.__contentHeight*b-this.__clientHeight,0)},__startDeceleration:function(b){var a=this;if(a.options.paging){b=Math.max(Math.min(a.__scrollLeft,a.__maxScrollLeft),0);var d=Math.max(Math.min(a.__scrollTop,a.__maxScrollTop),
0),f=a.__clientWidth,e=a.__clientHeight;a.__minDecelerationScrollLeft=Math.floor(b/f)*f;a.__minDecelerationScrollTop=Math.floor(d/e)*e;a.__maxDecelerationScrollLeft=Math.ceil(b/f)*f;a.__maxDecelerationScrollTop=Math.ceil(d/e)*e}else a.__minDecelerationScrollLeft=0,a.__minDecelerationScrollTop=0,a.__maxDecelerationScrollLeft=a.__maxScrollLeft,a.__maxDecelerationScrollTop=a.__maxScrollTop;var c=a.options.snapping?4:0.1;a.__isDecelerating=core.effect.Animate.start(function(b,c,d){a.__stepThroughDeceleration(d)},
function(){return Math.abs(a.__decelerationVelocityX)>=c||Math.abs(a.__decelerationVelocityY)>=c},function(b,c,d){a.__isDecelerating=!1;a.scrollTo(a.__scrollLeft,a.__scrollTop,a.options.snapping)})},__stepThroughDeceleration:function(b){var a=this.__scrollLeft+this.__decelerationVelocityX,d=this.__scrollTop+this.__decelerationVelocityY;if(!this.options.bouncing){var f=Math.max(Math.min(this.__maxScrollLeft,a),0);f!==a&&(a=f,this.__decelerationVelocityX=0);f=Math.max(Math.min(this.__maxScrollTop,d),
0);f!==d&&(d=f,this.__decelerationVelocityY=0)}b?this.__publish(a,d,this.__zoomLevel):(this.__scrollLeft=a,this.__scrollTop=d);this.options.paging||(this.__decelerationVelocityX*=0.95,this.__decelerationVelocityY*=0.95);this.options.bouncing&&(f=b=0,a<this.__minDecelerationScrollLeft?b=this.__minDecelerationScrollLeft-a:a>this.__maxDecelerationScrollLeft&&(b=this.__maxDecelerationScrollLeft-a),d<this.__minDecelerationScrollTop?f=this.__minDecelerationScrollTop-d:d>this.__maxDecelerationScrollTop&&
(f=this.__maxDecelerationScrollTop-d),0!==b&&(this.__decelerationVelocityX=0>=b*this.__decelerationVelocityX?this.__decelerationVelocityX+0.03*b:0.08*b),0!==f&&(this.__decelerationVelocityY=0>=f*this.__decelerationVelocityY?this.__decelerationVelocityY+0.03*f:0.08*f))}},m;for(m in g)Scroller.prototype[m]=g[m]})();
